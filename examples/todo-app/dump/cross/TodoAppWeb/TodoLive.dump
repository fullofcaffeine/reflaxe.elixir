@:realPath("server.live.TodoLive") @:used @:keep @:native("TodoAppWeb.TodoLive") @:liveview
class TodoAppWeb.TodoLive {

	@:keep
	public static function mount(_params:server.types.MountParams, session:server.types.Session, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var now = cast DateTime.utc_now();
		haxe.Log.trace("Current time: " + cast now.to_iso8601(), {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 109, className : "server.live.TodoLive", methodName : "mount"});
		@:ast(switch (TodoPubSub.subscribe(TodoUpdates)) {
	case Error(reason):
		return Error("Failed to subscribe to updates: " + reason);	
	case Ok(_):
}) {
			var _g = server.pubsub.TodoPubSub.subscribe(server.pubsub.TodoPubSubTopic.TodoUpdates);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{};
				};
				case 1: {
					var _g = _g[0];
					{
						var reason = _g;
						return phoenix.MountResult.Error("Failed to subscribe to updates: " + reason);
					};
				};
			};
		};
		var currentUser = TodoAppWeb.TodoLive.getUserFromSession(session);
		var todos = TodoAppWeb.TodoLive.loadTodos(currentUser.id);
		var presenceSocket = TodoAppWeb.Presence.trackUser(socket, currentUser);
		var assigns = {todos : todos, filter : "all", sortBy : "created", currentUser : currentUser, editingTodo : null, showForm : false, searchQuery : "", selectedTags : [], totalTodos : todos.length, completedTodos : TodoAppWeb.TodoLive.countCompleted(todos), pendingTodos : TodoAppWeb.TodoLive.countPending(todos), onlineUsers : new haxe.ds.StringMap()};
		var updatedSocket = __elixir__("assign({0}, {1})", presenceSocket, cast assigns);
		return phoenix.MountResult.Ok(updatedSocket);
	}

	@:keep
	public static function handleEvent(event:server.live.TodoLiveEvent, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var resultSocket = @:ast(switch (event) {
	case CreateTodo(params):
		createTodoTyped(params, socket);	
	case ToggleTodo(id):
		toggleTodoStatus(id, socket);	
	case DeleteTodo(id):
		deleteTodo(id, socket);	
	case EditTodo(id):
		startEditing(id, socket);	
	case SaveTodo(params):
		saveEditedTodoTyped(params, socket);	
	case CancelEdit:
		var presenceSocket = server.presence.TodoPresence.updateUserEditing(socket, socket.assigns.currentUser, null);
		SafeAssigns.setEditingTodo(presenceSocket, null);	
	case FilterTodos(filter):
		SafeAssigns.setFilter(socket, filter);	
	case SortTodos(sortBy):
		SafeAssigns.setSortBy(socket, sortBy);	
	case SearchTodos(query):
		SafeAssigns.setSearchQuery(socket, query);	
	case ToggleTag(tag):
		toggleTagFilter(tag, socket);	
	case SetPriority(id, priority):
		updateTodoPriority(id, priority, socket);	
	case ToggleForm:
		SafeAssigns.setShowForm(socket, !socket.assigns.showForm);	
	case BulkComplete:
		completeAllTodos(socket);	
	case BulkDeleteCompleted:
		deleteCompletedTodos(socket);	
}) switch ((@:exhaustive enumIndex event)) {
			case 0: {
				var _g = event[0];
				{
					var params = _g;
					TodoAppWeb.TodoLive.createTodoTyped(params, socket);
				};
			};
			case 1: {
				var _g = event[0];
				{
					var id = _g;
					TodoAppWeb.TodoLive.toggleTodoStatus(id, socket);
				};
			};
			case 2: {
				var _g = event[0];
				{
					var id = _g;
					TodoAppWeb.TodoLive.deleteTodo(id, socket);
				};
			};
			case 3: {
				var _g = event[0];
				{
					var id = _g;
					TodoAppWeb.TodoLive.startEditing(id, socket);
				};
			};
			case 4: {
				var _g = event[0];
				{
					var params = _g;
					TodoAppWeb.TodoLive.saveEditedTodoTyped(params, socket);
				};
			};
			case 5: {
				var presenceSocket = TodoAppWeb.Presence.updateUserEditing(socket, socket.assigns.currentUser, null);
				server.live.SafeAssigns.setEditingTodo(presenceSocket, null);
			};
			case 6: {
				var _g = event[0];
				{
					var filter = _g;
					server.live.SafeAssigns.setFilter(socket, filter);
				};
			};
			case 7: {
				var _g = event[0];
				{
					var sortBy = _g;
					server.live.SafeAssigns.setSortBy(socket, sortBy);
				};
			};
			case 8: {
				var _g = event[0];
				{
					var query = _g;
					server.live.SafeAssigns.setSearchQuery(socket, query);
				};
			};
			case 9: {
				var _g = event[0];
				{
					var tag = _g;
					TodoAppWeb.TodoLive.toggleTagFilter(tag, socket);
				};
			};
			case 10: {
				var _g = event[0];
				var _g1 = event[1];
				{
					var id = _g;
					var priority = _g1;
					TodoAppWeb.TodoLive.updateTodoPriority(id, priority, socket);
				};
			};
			case 11: server.live.SafeAssigns.setShowForm(socket, ! socket.assigns.showForm);
			case 12: TodoAppWeb.TodoLive.completeAllTodos(socket);
			case 13: TodoAppWeb.TodoLive.deleteCompletedTodos(socket);
		};
		return phoenix.HandleEventResult.NoReply(resultSocket);
	}

	@:keep
	public static function handleInfo(msg:server.types.PubSubMessage, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var resultSocket = @:ast(switch (TodoPubSub.parseMessage(msg)) {
	case Some(parsedMsg):
		switch (parsedMsg) {
			case TodoCreated(todo):
				addTodoToList(todo, socket);			
			case TodoUpdated(todo):
				updateTodoInList(todo, socket);			
			case TodoDeleted(id):
				removeTodoFromList(id, socket);			
			case BulkUpdate(action):
				handleBulkUpdate(action, socket);			
			case UserOnline(userId):
				socket;			
			case UserOffline(userId):
				socket;			
			case SystemAlert(message, level):
				var flashType = switch (level) {
					case Info:
						phoenix.Phoenix.FlashType.Info;					
					case Warning:
						phoenix.Phoenix.FlashType.Warning;					
					case Error:
						phoenix.Phoenix.FlashType.Error;					
					case Critical:
						phoenix.Phoenix.FlashType.Error;					
				};
				LiveView.putFlash(socket, flashType, message);			
		};	
	case None:
		trace("Received unknown PubSub message: " + msg);
		socket;	
}) {
			var _g = server.pubsub.TodoPubSub.parseMessage(msg);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{
						var parsedMsg = _g;
						@:ast(switch (parsedMsg) {
	case TodoCreated(todo):
		addTodoToList(todo, socket);	
	case TodoUpdated(todo):
		updateTodoInList(todo, socket);	
	case TodoDeleted(id):
		removeTodoFromList(id, socket);	
	case BulkUpdate(action):
		handleBulkUpdate(action, socket);	
	case UserOnline(userId):
		socket;	
	case UserOffline(userId):
		socket;	
	case SystemAlert(message, level):
		var flashType = switch (level) {
			case Info:
				phoenix.Phoenix.FlashType.Info;			
			case Warning:
				phoenix.Phoenix.FlashType.Warning;			
			case Error:
				phoenix.Phoenix.FlashType.Error;			
			case Critical:
				phoenix.Phoenix.FlashType.Error;			
		};
		LiveView.putFlash(socket, flashType, message);	
}) switch ((@:exhaustive enumIndex parsedMsg)) {
							case 0: {
								var _g = parsedMsg[0];
								{
									var todo = _g;
									TodoAppWeb.TodoLive.addTodoToList(todo, socket);
								};
							};
							case 1: {
								var _g = parsedMsg[0];
								{
									var todo = _g;
									TodoAppWeb.TodoLive.updateTodoInList(todo, socket);
								};
							};
							case 2: {
								var _g = parsedMsg[0];
								{
									var id = _g;
									TodoAppWeb.TodoLive.removeTodoFromList(id, socket);
								};
							};
							case 3: {
								var _g = parsedMsg[0];
								{
									var action = _g;
									TodoAppWeb.TodoLive.handleBulkUpdate(action, socket);
								};
							};
							case 4: {
								var _g = parsedMsg[0];
								{
									var userId = _g;
									socket;
								};
							};
							case 5: {
								var _g = parsedMsg[0];
								{
									var userId = _g;
									socket;
								};
							};
							case 6: {
								var _g = parsedMsg[0];
								var _g1 = parsedMsg[1];
								{
									var message = _g;
									var level = _g1;
									{
										var flashType = @:ast(switch (level) {
	case Info:
		phoenix.Phoenix.FlashType.Info;	
	case Warning:
		phoenix.Phoenix.FlashType.Warning;	
	case Error:
		phoenix.Phoenix.FlashType.Error;	
	case Critical:
		phoenix.Phoenix.FlashType.Error;	
}) switch ((@:exhaustive enumIndex level)) {
											case 0: phoenix.FlashType.Info;
											case 1: phoenix.FlashType.Warning;
											case 2: phoenix.FlashType.Error;
											case 3: phoenix.FlashType.Error;
										};
										Phoenix.LiveView.put_flash(socket, flashType, message);
									};
								};
							};
						};
					};
				};
				case 1: {
					haxe.Log.trace("Received unknown PubSub message: " + Std.string(msg), {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 254, className : "server.live.TodoLive", methodName : "handleInfo"});
					socket;
				};
			};
		};
		return phoenix.HandleInfoResult.NoReply(resultSocket);
	}

	@:keep
	static function createTodoTyped(params:server.schemas.TodoParams, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		params.userId = socket.assigns.currentUser.id;
		var changeset = TodoApp.Todo.changeset(new TodoApp.Todo(), params);
		@:ast(switch (Repo.insert(changeset)) {
	case Ok(todo):
		switch (TodoPubSub.broadcast(TodoUpdates, TodoCreated(todo))) {
			case Ok(_):
			case Error(reason):
				trace("Failed to broadcast todo creation: " + reason);			
		};
		var updatedSocket = loadAndAssignTodos(socket);
		return SafeAssigns.setShowForm(updatedSocket, false);	
	case Error(changeset):
		return LiveView.putFlash(socket, phoenix.Phoenix.FlashType.Error, "Failed to create todo");	
}) {
			var _g = TodoApp.Repo.insert(changeset);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{
						var todo = _g;
						{
							@:ast(switch (TodoPubSub.broadcast(TodoUpdates, TodoCreated(todo))) {
	case Ok(_):
	case Error(reason):
		trace("Failed to broadcast todo creation: " + reason);	
}) {
								var _g = server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.TodoCreated(todo));
								switch ((@:exhaustive enumIndex _g)) {
									case 0: {
										var _g = _g[0];
										{};
									};
									case 1: {
										var _g = _g[0];
										{
											var reason = _g;
											haxe.Log.trace("Failed to broadcast todo creation: " + reason, {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 281, className : "server.live.TodoLive", methodName : "createTodoTyped"});
										};
									};
								};
							};
							var updatedSocket = TodoAppWeb.TodoLive.loadAndAssignTodos(socket);
							return server.live.SafeAssigns.setShowForm(updatedSocket, false);
						};
					};
				};
				case 1: {
					var _g = _g[0];
					{
						var changeset = _g;
						return Phoenix.LiveView.put_flash(socket, phoenix.FlashType.Error, "Failed to create todo");
					};
				};
			};
		};
	}

	@:keep
	static function createNewTodo(params:server.types.EventParams, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var todoParams = {title : params.title, description : params.description, completed : cast false, priority : if ((params.priority != null)) params.priority else "medium", dueDate : if ((params.dueDate != null)) _Date.Date_Impl_.fromString(params.dueDate) else null, tags : if ((params.tags != null)) TodoAppWeb.TodoLive.parseTags(params.tags) else [], userId : cast socket.assigns.currentUser.id};
		var changeset = TodoApp.Todo.changeset(new TodoApp.Todo(), todoParams);
		@:ast(switch (Repo.insert(changeset)) {
	case Ok(todo):
		switch (TodoPubSub.broadcast(TodoUpdates, TodoCreated(todo))) {
			case Ok(_):
			case Error(reason):
				trace("Failed to broadcast todo creation: " + reason);			
		};
		var todos = [todo].concat(socket.assigns.todos);
		var liveSocket:LiveSocket<TodoLiveAssigns> = socket;
		var updatedSocket = liveSocket.merge({ todos : todos, showForm : false });
		return LiveView.putFlash(updatedSocket, phoenix.Phoenix.FlashType.Success, "Todo created successfully!");	
	case Error(reason):
		return LiveView.putFlash(socket, phoenix.Phoenix.FlashType.Error, "Failed to create todo: " + reason);	
}) {
			var _g = TodoApp.Repo.insert(changeset);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{
						var todo = _g;
						{
							@:ast(switch (TodoPubSub.broadcast(TodoUpdates, TodoCreated(todo))) {
	case Ok(_):
	case Error(reason):
		trace("Failed to broadcast todo creation: " + reason);	
}) {
								var _g = server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.TodoCreated(todo));
								switch ((@:exhaustive enumIndex _g)) {
									case 0: {
										var _g = _g[0];
										{};
									};
									case 1: {
										var _g = _g[0];
										{
											var reason = _g;
											haxe.Log.trace("Failed to broadcast todo creation: " + reason, {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 318, className : "server.live.TodoLive", methodName : "createNewTodo"});
										};
									};
								};
							};
							var todos = [todo].concat(socket.assigns.todos);
							var liveSocket = socket;
							var updatedSocket = Phoenix.Component.assign(liveSocket, {todos : todos, show_form : false});
							return Phoenix.LiveView.put_flash(updatedSocket, phoenix.FlashType.Success, "Todo created successfully!");
						};
					};
				};
				case 1: {
					var _g = _g[0];
					{
						var reason = _g;
						return Phoenix.LiveView.put_flash(socket, phoenix.FlashType.Error, "Failed to create todo: " + reason);
					};
				};
			};
		};
	}

	@:keep
	static function toggleTodoStatus(id:Int, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var todo = TodoAppWeb.TodoLive.findTodo(id, socket.assigns.todos);
		if ((todo == null)) return socket;
		var updatedChangeset = TodoApp.Todo.toggleCompleted(todo);
		var updatedTodo = @:ast(switch (Repo.update(updatedChangeset)) {
	case Ok(u):
		u;	
	case Error(reason):
		return LiveView.putFlash(socket, phoenix.Phoenix.FlashType.Error, "Failed to update todo: " + reason);	
}) {
			var _g = TodoApp.Repo.update(updatedChangeset);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{
						var u = _g;
						u;
					};
				};
				case 1: {
					var _g = _g[0];
					{
						var reason = _g;
						return Phoenix.LiveView.put_flash(socket, phoenix.FlashType.Error, "Failed to update todo: " + reason);
					};
				};
			};
		};
		server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.TodoUpdated(updatedTodo));
		return TodoAppWeb.TodoLive.updateTodoInList(updatedTodo, socket);
	}

	@:keep
	static function deleteTodo(id:Int, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var todo = TodoAppWeb.TodoLive.findTodo(id, socket.assigns.todos);
		if ((todo == null)) return socket;
		@:ast(switch (Repo.delete(todo)) {
	case Ok(deletedTodo):
		switch (TodoPubSub.broadcast(TodoUpdates, TodoDeleted(id))) {
			case Ok(_):
			case Error(reason):
				trace("Failed to broadcast todo deletion: " + reason);			
		};
		return removeTodoFromList(id, socket);	
	case Error(reason):
		return LiveView.putFlash(socket, phoenix.Phoenix.FlashType.Error, "Failed to delete todo: " + reason);	
}) {
			var _g = TodoApp.Repo.delete(todo);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{
						var deletedTodo = _g;
						{
							@:ast(switch (TodoPubSub.broadcast(TodoUpdates, TodoDeleted(id))) {
	case Ok(_):
	case Error(reason):
		trace("Failed to broadcast todo deletion: " + reason);	
}) {
								var _g = server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.TodoDeleted(id));
								switch ((@:exhaustive enumIndex _g)) {
									case 0: {
										var _g = _g[0];
										{};
									};
									case 1: {
										var _g = _g[0];
										{
											var reason = _g;
											haxe.Log.trace("Failed to broadcast todo deletion: " + reason, {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 363, className : "server.live.TodoLive", methodName : "deleteTodo"});
										};
									};
								};
							};
							return TodoAppWeb.TodoLive.removeTodoFromList(id, socket);
						};
					};
				};
				case 1: {
					var _g = _g[0];
					{
						var reason = _g;
						return Phoenix.LiveView.put_flash(socket, phoenix.FlashType.Error, "Failed to delete todo: " + reason);
					};
				};
			};
		};
	}

	@:keep
	static function updateTodoPriority(id:Int, priority:String, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var todo = TodoAppWeb.TodoLive.findTodo(id, socket.assigns.todos);
		if ((todo == null)) return socket;
		var updatedChangeset = TodoApp.Todo.updatePriority(todo, priority);
		var updatedTodo = @:ast(switch (Repo.update(updatedChangeset)) {
	case Ok(u):
		u;	
	case Error(reason):
		return LiveView.putFlash(socket, phoenix.Phoenix.FlashType.Error, "Failed to update priority: " + reason);	
}) {
			var _g = TodoApp.Repo.update(updatedChangeset);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{
						var u = _g;
						u;
					};
				};
				case 1: {
					var _g = _g[0];
					{
						var reason = _g;
						return Phoenix.LiveView.put_flash(socket, phoenix.FlashType.Error, "Failed to update priority: " + reason);
					};
				};
			};
		};
		server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.TodoUpdated(updatedTodo));
		return TodoAppWeb.TodoLive.updateTodoInList(updatedTodo, socket);
	}

	@:keep
	static function addTodoToList(todo:TodoApp.Todo, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		if ((todo.userId == socket.assigns.currentUser.id)) return socket;
		var todos = [todo].concat(socket.assigns.todos);
		var liveSocket = socket;
		return Phoenix.Component.assign(liveSocket, {todos : todos});
	}

	@:keep
	static function loadTodos(userId:Int) {
		var query = {
			var this1 = cast {
				var this1 = cast {
					var query = cast __elixir__("Ecto.Queryable.to_query({0})", TodoApp.Todo);
					var this1;
					this1 = query;
					cast this1;
				};
				var newQuery = __elixir__("(require Ecto.Query; Ecto.Query.where({0}, [q], field(q, ^String.to_existing_atom(Macro.underscore({1}))) == ^{2}))", this1, "userId", userId);
				{
					var this1;
					this1 = cast newQuery;
					cast this1;
				};
			};
			var direction = "asc";
			if ((direction == null)) direction = "asc";
			var newQuery = if ((direction == "desc")) __elixir__("(require Ecto.Query; Ecto.Query.order_by({0}, [q], [desc: field(q, ^String.to_existing_atom(Macro.underscore({1})))]))", this1, "inserted_at") else __elixir__("(require Ecto.Query; Ecto.Query.order_by({0}, [q], [asc: field(q, ^String.to_existing_atom(Macro.underscore({1})))]))", this1, "inserted_at");
			{
				var this1;
				this1 = cast newQuery;
				cast this1;
			};
		};
		return TodoApp.Repo.all(query);
	}

	@:keep
	static function findTodo(id:Int, todos:Array<TodoApp.Todo>) {
		{
			var _g = 0;
			while ((_g < todos.length)) {
				var todo = todos[_g];
				++ _g;
				if ((todo.id == id)) return todo;
			};
		};
		return null;
	}

	@:keep
	static function countCompleted(todos:Array<TodoApp.Todo>) {
		var count = 0;
		{
			var _g = 0;
			while ((_g < todos.length)) {
				var todo = todos[_g];
				++ _g;
				if ((todo.completed)) count ++;
			};
		};
		return count;
	}

	@:keep
	static function countPending(todos:Array<TodoApp.Todo>) {
		var count = 0;
		{
			var _g = 0;
			while ((_g < todos.length)) {
				var todo = todos[_g];
				++ _g;
				if ((! todo.completed)) count ++;
			};
		};
		return count;
	}

	@:keep
	static function parseTags(tagsString:String) {
		if ((tagsString == null || tagsString == "")) return [];
		return __elixir__("String.split({0}, {1})", tagsString, ",").map(function(t:String) {
			return StringTools.ltrim(StringTools.rtrim(t));
		});
	}

	@:keep
	static function getUserFromSession(session:Dynamic) {
		var idVal = Reflect.field(session, "user_id");
		var uid = if ((idVal != null)) idVal else 1;
		return {id : uid, name : "Demo User", email : "demo@example.com", passwordHash : "hashed_password", confirmedAt : null, lastLoginAt : null, active : true};
	}

	@:keep
	static function loadAndAssignTodos(socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var todos = TodoAppWeb.TodoLive.loadTodos(socket.assigns.currentUser.id);
		var liveSocket = socket;
		return Phoenix.Component.assign(liveSocket, {todos : todos, total_todos : todos.length, completed_todos : TodoAppWeb.TodoLive.countCompleted(todos), pending_todos : TodoAppWeb.TodoLive.countPending(todos)});
	}

	@:keep
	static function updateTodoInList(todo:TodoApp.Todo, socket:phoenix.LiveSocket<server.live.TodoLiveAssigns>) {
		var todos = cast socket.assigns.todos;
		var updatedTodos = todos.map(function(t:TodoApp.Todo) {
			return if ((t.id == todo.id)) todo else t;
		});
		return Phoenix.Component.assign(socket, {todos : updatedTodos, total_todos : updatedTodos.length, completed_todos : TodoAppWeb.TodoLive.countCompleted(updatedTodos), pending_todos : TodoAppWeb.TodoLive.countPending(updatedTodos)});
	}

	@:keep
	static function removeTodoFromList(id:Int, socket:phoenix.LiveSocket<server.live.TodoLiveAssigns>) {
		var todos = cast socket.assigns.todos;
		var updatedTodos = todos.filter(function(t:TodoApp.Todo) {
			return t.id != id;
		});
		return Phoenix.Component.assign(socket, {todos : updatedTodos, total_todos : updatedTodos.length, completed_todos : TodoAppWeb.TodoLive.countCompleted(updatedTodos), pending_todos : TodoAppWeb.TodoLive.countPending(updatedTodos)});
	}

	@:keep
	static function startEditing(id:Int, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var todo = TodoAppWeb.TodoLive.findTodo(id, socket.assigns.todos);
		var presenceSocket = TodoAppWeb.Presence.updateUserEditing(socket, socket.assigns.currentUser, id);
		return server.live.SafeAssigns.setEditingTodo(presenceSocket, todo);
	}

	@:keep
	static function completeAllTodos(socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var pending = socket.assigns.todos.filter(function(t:TodoApp.Todo) {
			return ! t.completed;
		});
		{
			var _g = 0;
			while ((_g < pending.length)) {
				var todo = pending[_g];
				++ _g;
				var updatedChangeset = TodoApp.Todo.toggleCompleted(todo);
				@:ast(switch (Repo.update(updatedChangeset)) {
	case Ok(updatedTodo):
	case Error(reason):
		trace("Failed to complete todo " + todo.id + ": " + reason);	
}) {
					var _g = TodoApp.Repo.update(updatedChangeset);
					switch ((@:exhaustive enumIndex _g)) {
						case 0: {
							var _g = _g[0];
							{
								var updatedTodo = _g;
								{};
							};
						};
						case 1: {
							var _g = _g[0];
							{
								var reason = _g;
								haxe.Log.trace("Failed to complete todo " + todo.id + ": " + reason, {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 516, className : "server.live.TodoLive", methodName : "completeAllTodos"});
							};
						};
					};
				};
			};
		};
		@:ast(switch (TodoPubSub.broadcast(TodoUpdates, BulkUpdate(CompleteAll))) {
	case Ok(_):
	case Error(reason):
		trace("Failed to broadcast bulk complete: " + reason);	
}) {
			var _g = server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.BulkUpdate(server.types.BulkOperationType.CompleteAll));
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{};
				};
				case 1: {
					var _g = _g[0];
					{
						var reason = _g;
						haxe.Log.trace("Failed to broadcast bulk complete: " + reason, {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 525, className : "server.live.TodoLive", methodName : "completeAllTodos"});
					};
				};
			};
		};
		var updatedTodos = TodoAppWeb.TodoLive.loadTodos(socket.assigns.currentUser.id);
		var currentAssigns = socket.assigns;
		var completeAssigns = {todos : updatedTodos, filter : currentAssigns.filter, sortBy : currentAssigns.sortBy, currentUser : currentAssigns.currentUser, editingTodo : currentAssigns.editingTodo, showForm : currentAssigns.showForm, searchQuery : currentAssigns.searchQuery, selectedTags : currentAssigns.selectedTags, totalTodos : updatedTodos.length, completedTodos : updatedTodos.length, pendingTodos : 0, onlineUsers : currentAssigns.onlineUsers};
		var updatedSocket = __elixir__("assign({0}, {1})", socket, cast completeAssigns);
		return Phoenix.LiveView.put_flash(updatedSocket, phoenix.FlashType.Info, "All todos marked as completed!");
	}

	@:keep
	static function deleteCompletedTodos(socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var completed = socket.assigns.todos.filter(function(t:TodoApp.Todo) {
			return t.completed;
		});
		{
			var _g = 0;
			while ((_g < completed.length)) {
				var todo = completed[_g];
				++ _g;
				TodoApp.Repo.delete(todo);
			};
		};
		server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.BulkUpdate(server.types.BulkOperationType.DeleteCompleted));
		var remaining = socket.assigns.todos.filter(function(t:TodoApp.Todo) {
			return ! t.completed;
		});
		var currentAssigns = socket.assigns;
		var completeAssigns = {todos : remaining, filter : currentAssigns.filter, sortBy : currentAssigns.sortBy, currentUser : currentAssigns.currentUser, editingTodo : currentAssigns.editingTodo, showForm : currentAssigns.showForm, searchQuery : currentAssigns.searchQuery, selectedTags : currentAssigns.selectedTags, totalTodos : remaining.length, completedTodos : 0, pendingTodos : remaining.length, onlineUsers : currentAssigns.onlineUsers};
		var updatedSocket = __elixir__("assign({0}, {1})", socket, cast completeAssigns);
		return Phoenix.LiveView.put_flash(updatedSocket, phoenix.FlashType.Info, "Completed todos deleted!");
	}

	@:keep
	static function startEditingOld(id:Int, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var todo = TodoAppWeb.TodoLive.findTodo(id, socket.assigns.todos);
		return server.live.SafeAssigns.setEditingTodo(socket, todo);
	}

	@:keep
	static function saveEditedTodoTyped(params:server.schemas.TodoParams, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		if ((socket.assigns.editingTodo == null)) return socket;
		var todo = socket.assigns.editingTodo;
		var changeset = TodoApp.Todo.changeset(todo, params);
		@:ast(switch (Repo.update(changeset)) {
	case Ok(updatedTodo):
		switch (TodoPubSub.broadcast(TodoUpdates, TodoUpdated(updatedTodo))) {
			case Ok(_):
			case Error(reason):
				trace("Failed to broadcast todo update: " + reason);			
		};
		var presenceSocket = server.presence.TodoPresence.updateUserEditing(socket, socket.assigns.currentUser, null);
		var updatedSocket = SafeAssigns.setEditingTodo(presenceSocket, null);
		return loadAndAssignTodos(updatedSocket);	
	case Error(changeset):
		return LiveView.putFlash(socket, phoenix.Phoenix.FlashType.Error, "Failed to update todo");	
}) {
			var _g = TodoApp.Repo.update(changeset);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{
						var updatedTodo = _g;
						{
							@:ast(switch (TodoPubSub.broadcast(TodoUpdates, TodoUpdated(updatedTodo))) {
	case Ok(_):
	case Error(reason):
		trace("Failed to broadcast todo update: " + reason);	
}) {
								var _g = server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.TodoUpdated(updatedTodo));
								switch ((@:exhaustive enumIndex _g)) {
									case 0: {
										var _g = _g[0];
										{};
									};
									case 1: {
										var _g = _g[0];
										{
											var reason = _g;
											haxe.Log.trace("Failed to broadcast todo update: " + reason, {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 606, className : "server.live.TodoLive", methodName : "saveEditedTodoTyped"});
										};
									};
								};
							};
							var presenceSocket = TodoAppWeb.Presence.updateUserEditing(socket, socket.assigns.currentUser, null);
							var updatedSocket = server.live.SafeAssigns.setEditingTodo(presenceSocket, null);
							return TodoAppWeb.TodoLive.loadAndAssignTodos(updatedSocket);
						};
					};
				};
				case 1: {
					var _g = _g[0];
					{
						var changeset = _g;
						return Phoenix.LiveView.put_flash(socket, phoenix.FlashType.Error, "Failed to update todo");
					};
				};
			};
		};
	}

	@:keep
	static function saveEditedTodo(params:server.types.EventParams, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var todo = socket.assigns.editingTodo;
		if ((todo == null)) return socket;
		var todoParams = {title : params.title, description : params.description, priority : params.priority, dueDate : if ((params.dueDate != null)) _Date.Date_Impl_.fromString(params.dueDate) else null, tags : if ((params.tags != null)) TodoAppWeb.TodoLive.parseTags(params.tags) else null, completed : params.completed};
		var changeset = TodoApp.Todo.changeset(todo, todoParams);
		@:ast(switch (Repo.update(changeset)) {
	case Ok(updatedTodo):
		switch (TodoPubSub.broadcast(TodoUpdates, TodoUpdated(updatedTodo))) {
			case Ok(_):
			case Error(reason):
				trace("Failed to broadcast todo save: " + reason);			
		};
		var updatedSocket = updateTodoInList(updatedTodo, socket);
		var liveSocket:LiveSocket<TodoLiveAssigns> = updatedSocket;
		return liveSocket.assign(_.editingTodo, null);	
	case Error(reason):
		return LiveView.putFlash(socket, phoenix.Phoenix.FlashType.Error, "Failed to save todo: " + reason);	
}) {
			var _g = TodoApp.Repo.update(changeset);
			switch ((@:exhaustive enumIndex _g)) {
				case 0: {
					var _g = _g[0];
					{
						var updatedTodo = _g;
						{
							@:ast(switch (TodoPubSub.broadcast(TodoUpdates, TodoUpdated(updatedTodo))) {
	case Ok(_):
	case Error(reason):
		trace("Failed to broadcast todo save: " + reason);	
}) {
								var _g = server.pubsub.TodoPubSub.broadcast(server.pubsub.TodoPubSubTopic.TodoUpdates, server.pubsub.TodoPubSubMessage.TodoUpdated(updatedTodo));
								switch ((@:exhaustive enumIndex _g)) {
									case 0: {
										var _g = _g[0];
										{};
									};
									case 1: {
										var _g = _g[0];
										{
											var reason = _g;
											haxe.Log.trace("Failed to broadcast todo save: " + reason, {fileName : "src_haxe/server/live/TodoLive.hx", lineNumber : 643, className : "server.live.TodoLive", methodName : "saveEditedTodo"});
										};
									};
								};
							};
							var updatedSocket = TodoAppWeb.TodoLive.updateTodoInList(updatedTodo, socket);
							var liveSocket = updatedSocket;
							return Phoenix.Component.assign(liveSocket, "editing_todo", null);
						};
					};
				};
				case 1: {
					var _g = _g[0];
					{
						var reason = _g;
						return Phoenix.LiveView.put_flash(socket, phoenix.FlashType.Error, "Failed to save todo: " + reason);
					};
				};
			};
		};
	}

	@:keep
	static function handleBulkUpdate(action:server.types.BulkOperationType, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		return @:ast(switch (action) {
	case CompleteAll:
		var updatedTodos = loadTodos(socket.assigns.currentUser.id);
		var liveSocket:LiveSocket<TodoLiveAssigns> = socket;
		return liveSocket.merge({ todos : updatedTodos, totalTodos : updatedTodos.length, completedTodos : countCompleted(updatedTodos), pendingTodos : countPending(updatedTodos) });	
	case DeleteCompleted:
		var updatedTodos = loadTodos(socket.assigns.currentUser.id);
		var liveSocket:LiveSocket<TodoLiveAssigns> = socket;
		return liveSocket.merge({ todos : updatedTodos, totalTodos : updatedTodos.length, completedTodos : countCompleted(updatedTodos), pendingTodos : countPending(updatedTodos) });	
	case SetPriority(priority):
		socket;	
	case AddTag(tag):
		socket;	
	case RemoveTag(tag):
		socket;	
}) switch ((@:exhaustive enumIndex action)) {
			case 0: {
				var updatedTodos = TodoAppWeb.TodoLive.loadTodos(socket.assigns.currentUser.id);
				var liveSocket = socket;
				return Phoenix.Component.assign(liveSocket, {todos : updatedTodos, total_todos : updatedTodos.length, completed_todos : TodoAppWeb.TodoLive.countCompleted(updatedTodos), pending_todos : TodoAppWeb.TodoLive.countPending(updatedTodos)});
			};
			case 1: {
				var updatedTodos = TodoAppWeb.TodoLive.loadTodos(socket.assigns.currentUser.id);
				var liveSocket = socket;
				return Phoenix.Component.assign(liveSocket, {todos : updatedTodos, total_todos : updatedTodos.length, completed_todos : TodoAppWeb.TodoLive.countCompleted(updatedTodos), pending_todos : TodoAppWeb.TodoLive.countPending(updatedTodos)});
			};
			case 2: {
				var _g = action[0];
				{
					var priority = _g;
					socket;
				};
			};
			case 3: {
				var _g = action[0];
				{
					var tag = _g;
					socket;
				};
			};
			case 4: {
				var _g = action[0];
				{
					var tag = _g;
					socket;
				};
			};
		};
	}

	@:keep
	static function toggleTagFilter(tag:String, socket:Phoenix.LiveView.Socket<server.live.TodoLiveAssigns>) {
		var selectedTags = socket.assigns.selectedTags;
		var updatedTags = if ((selectedTags.contains(tag))) selectedTags.filter(function(t:String) {
			return t != tag;
		}) else selectedTags.concat([tag]);
		return server.live.SafeAssigns.setSelectedTags(socket, updatedTags);
	}

	@:keep
	public static function index() {
		return "index";
	}

	@:keep
	public static function show() {
		return "show";
	}

	@:keep
	public static function edit() {
		return "edit";
	}

	@:keep
	public static function render(assigns:server.live.TodoLiveAssigns) {
		return {
			var templateStr = "\n\t\t\t<div class=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-blue-900\">\n\t\t\t\t<div class=\"container mx-auto px-4 py-8 max-w-6xl\">\n\t\t\t\t\t\n\t\t\t\t\t<!-- Header -->\n\t\t\t\t\t<div class=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 mb-8\">\n\t\t\t\t\t\t<div class=\"flex justify-between items-center mb-6\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<h1 class=\"text-4xl font-bold text-gray-800 dark:text-white mb-2\">\n\t\t\t\t\t\t\t\t\tüìù Todo Manager\n\t\t\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t\t\t<p class=\"text-gray-600 dark:text-gray-400\">\n\t\t\t\t\t\t\t\t\tWelcome, <%= @currentUser.name %>!\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<!-- Statistics -->\n\t\t\t\t\t\t\t<div class=\"flex space-x-6\">\n\t\t\t\t\t\t\t\t<div class=\"text-center\">\n\t\t\t\t\t\t\t\t\t<div class=\"text-3xl font-bold text-blue-600 dark:text-blue-400\">\n\t\t\t\t\t\t\t\t\t\t<%= @totalTodos %>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-600 dark:text-gray-400\">Total</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-center\">\n\t\t\t\t\t\t\t\t\t<div class=\"text-3xl font-bold text-green-600 dark:text-green-400\">\n\t\t\t\t\t\t\t\t\t\t<%= @completedTodos %>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-600 dark:text-gray-400\">Completed</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-center\">\n\t\t\t\t\t\t\t\t\t<div class=\"text-3xl font-bold text-amber-600 dark:text-amber-400\">\n\t\t\t\t\t\t\t\t\t\t<%= @pendingTodos %>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-gray-600 dark:text-gray-400\">Pending</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- Add Todo Button -->\n\t\t\t\t\t\t<button phx-click=\"toggle_form\" class=\"w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-md\">\n\t\t\t\t\t\t\t<%= if @showForm, do: \"‚úñ Cancel\", else: \"‚ûï Add New Todo\" %>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<!-- New Todo Form -->\n\t\t\t\t\t<%= if @showForm do %>\n\t\t\t\t\t\t<div class=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border-l-4 border-blue-500\">\n\t\t\t\t\t\t\t<form phx-submit=\"create_todo\" class=\"space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\t\tTitle *\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"title\" required\n\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"What needs to be done?\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\t\tDescription\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<textarea name=\"description\" rows=\"3\"\n\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Add more details...\"></textarea>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\t\t\tPriority\n\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t<select name=\"priority\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\">\n\t\t\t\t\t\t\t\t\t\t\t<option value=\"low\">Low</option>\n\t\t\t\t\t\t\t\t\t\t\t<option value=\"medium\" selected>Medium</option>\n\t\t\t\t\t\t\t\t\t\t\t<option value=\"high\">High</option>\n\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\t\t\tDue Date\n\t\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"date\" name=\"dueDate\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\t\tTags (comma-separated)\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"tags\"\n\t\t\t\t\t\t\t\t\t\tclass=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"work, personal, urgent\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<button type=\"submit\"\n\t\t\t\t\t\t\t\t\tclass=\"w-full py-3 bg-green-500 text-white font-medium rounded-lg hover:bg-green-600 transition-colors shadow-md\">\n\t\t\t\t\t\t\t\t\t‚úÖ Create Todo\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t<% end %>\n\t\t\t\t\t\n\t\t\t\t\t<!-- Filters and Search -->\n\t\t\t\t\t<div class=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8\">\n\t\t\t\t\t\t<div class=\"flex flex-wrap gap-4\">\n\t\t\t\t\t\t\t<!-- Search -->\n\t\t\t\t\t\t\t<div class=\"flex-1 min-w-[300px]\">\n\t\t\t\t\t\t\t\t<form phx-change=\"SearchTodos\" class=\"relative\">\n\t\t\t\t\t\t\t\t\t<input type=\"search\" name=\"query\" value={@searchQuery}\n\t\t\t\t\t\t\t\t\t\tclass=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search todos...\" />\n\t\t\t\t\t\t\t\t\t<span class=\"absolute left-3 top-2.5 text-gray-400\">üîç</span>\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<!-- Filter Buttons -->\n\t\t\t\t\t\t\t<div class=\"flex space-x-2\">\n\t\t\t\t\t\t\t\t<button phx-click=\"FilterTodos\" phx-value-filter=\"all\"\n\t\t\t\t\t\t\t\t\tclass={\"px-4 py-2 rounded-lg font-medium transition-colors \" <> if @filter == \"all\", do: \"bg-blue-500 text-white\", else: \"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300\"}>\n\t\t\t\t\t\t\t\t\tAll\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button phx-click=\"FilterTodos\" phx-value-filter=\"active\"\n\t\t\t\t\t\t\t\t\tclass={\"px-4 py-2 rounded-lg font-medium transition-colors \" <> if @filter == \"active\", do: \"bg-blue-500 text-white\", else: \"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300\"}>\n\t\t\t\t\t\t\t\t\tActive\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button phx-click=\"FilterTodos\" phx-value-filter=\"completed\"\n\t\t\t\t\t\t\t\t\tclass={\"px-4 py-2 rounded-lg font-medium transition-colors \" <> if @filter == \"completed\", do: \"bg-blue-500 text-white\", else: \"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300\"}>\n\t\t\t\t\t\t\t\t\tCompleted\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<!-- Sort Dropdown -->\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<select phx-change=\"sort_todos\" name=\"sortBy\"\n\t\t\t\t\t\t\t\t\tclass=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\">\n\t\t\t\t\t\t\t\t\t<option value=\"created\" selected={@sortBy == \"created\"}>Sort by Date</option>\n\t\t\t\t\t\t\t\t\t<option value=\"priority\" selected={@sortBy == \"priority\"}>Sort by Priority</option>\n\t\t\t\t\t\t\t\t\t<option value=\"dueDate\" selected={@sortBy == \"dueDate\"}>Sort by Due Date</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<!-- Online Users Panel -->\n\t\t\t\t\t" + TodoAppWeb.TodoLive.renderPresencePanel(assigns) + "\n\t\t\t\t\t\n\t\t\t\t\t<!-- Bulk Actions -->\n\t\t\t\t\t" + TodoAppWeb.TodoLive.renderBulkActions(assigns) + "\n\t\t\t\t\t\n\t\t\t\t\t<!-- Todo List -->\n\t\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t\t" + TodoAppWeb.TodoLive.renderTodoList(assigns) + "\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t";
			templateStr;
		};
	}

	@:keep
	static function renderPresencePanel(assigns:server.live.TodoLiveAssigns) {
		var onlineCount = 0;
		var onlineUsersList = [];
		var editingIndicators = [];
		{
			var _g = {
				var this1 = assigns.onlineUsers;
				cast this1.keyValueIterator();
			};
			while ((_g.hasNext())) {
				var _g = _g.next();
				var userId = _g.key;
				var entry = _g.value;
				{
					onlineCount ++;
					if ((entry.metas.length > 0)) {
						var meta = entry.metas[0];
						var editingBadge = if ((meta.editingTodoId != null)) " <span class=\"text-xs text-blue-500\">‚úèÔ∏è</span>" else "";
						onlineUsersList.push("<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t<div class=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n\t\t\t\t\t<span class=\"text-sm text-gray-700 dark:text-gray-300\">" + meta.userName + editingBadge + "</span>\n\t\t\t\t</div>");
						if ((meta.editingTodoId != null)) editingIndicators.push("<div class=\"text-xs text-gray-500 dark:text-gray-400 italic\">\n\t\t\t\t\t\tüñäÔ∏è " + meta.userName + " is editing todo #" + meta.editingTodoId + "\n\t\t\t\t\t</div>");
					};
				};
			};
		};
		if ((onlineCount == 0)) return "";
		return "<div class=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 mb-6\">\n\t\t\t<div class=\"flex items-center justify-between mb-2\">\n\t\t\t\t<h3 class=\"text-sm font-semibold text-gray-700 dark:text-gray-300\">\n\t\t\t\t\tüë• Online Users (" + onlineCount + ")\n\t\t\t\t</h3>\n\t\t\t</div>\n\t\t\t<div class=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n\t\t\t\t" + onlineUsersList.join("") + "\n\t\t\t</div>\n\t\t\t" + (if ((editingIndicators.length > 0)) "<div class=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 space-y-1\">" + editingIndicators.join("") + "</div>" else "") + "\n\t\t</div>";
	}

	@:keep
	static function renderBulkActions(assigns:server.live.TodoLiveAssigns) {
		if ((assigns.todos.length == 0)) return "";
		var filteredCount = TodoAppWeb.TodoLive.filterTodos(assigns.todos, assigns.filter, assigns.searchQuery).length;
		return "<div class=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 mb-6 flex justify-between items-center\">\n\t\t\t\t<div class=\"text-sm text-gray-600 dark:text-gray-400\">\n\t\t\t\t\tShowing " + filteredCount + " of " + assigns.totalTodos + " todos\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex space-x-2\">\n\t\t\t\t\t<button phx-click=\"bulk_complete\"\n\t\t\t\t\t\tclass=\"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm\">\n\t\t\t\t\t\t‚úÖ Complete All\n\t\t\t\t\t</button>\n\t\t\t\t\t<button phx-click=\"bulk_delete_completed\" \n\t\t\t\t\t\tdata-confirm=\"Are you sure you want to delete all completed todos?\"\n\t\t\t\t\t\tclass=\"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm\">\n\t\t\t\t\t\tüóëÔ∏è Delete Completed\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>";
	}

	@:keep
	static function renderTodoList(assigns:server.live.TodoLiveAssigns) {
		if ((assigns.todos.length == 0)) return "\n\t\t\t\t<div class=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-16 text-center\">\n\t\t\t\t\t<div class=\"text-6xl mb-4\">üìã</div>\n\t\t\t\t\t<h3 class=\"text-xl font-semibold text-gray-800 dark:text-white mb-2\">\n\t\t\t\t\t\tNo todos yet!\n\t\t\t\t\t</h3>\n\t\t\t\t\t<p class=\"text-gray-600 dark:text-gray-400\">\n\t\t\t\t\t\tClick \"Add New Todo\" to get started.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t";
		var filteredTodos = TodoAppWeb.TodoLive.filterAndSortTodos(assigns.todos, assigns.filter, assigns.sortBy, assigns.searchQuery);
		var todoItems = [];
		{
			var _g = 0;
			while ((_g < filteredTodos.length)) {
				var todo = filteredTodos[_g];
				++ _g;
				todoItems.push(TodoAppWeb.TodoLive.renderTodoItem(todo, assigns.editingTodo));
			};
		};
		return todoItems.join("\n");
	}

	@:keep
	static function renderTodoItem(todo:TodoApp.Todo, editingTodo:Null<TodoApp.Todo>) {
		var isEditing = editingTodo != null && editingTodo.id == todo.id;
		var priorityColor = @:ast(switch (todo.priority) {
	case "high":
		"border-red-500";	
	case "medium":
		"border-yellow-500";	
	case "low":
		"border-green-500";	
	case _:
		"border-gray-300";	
}) {
			var _g = todo.priority;
			switch ((_g)) {
				case "high": "border-red-500";
				case "low": "border-green-500";
				case "medium": "border-yellow-500";
				default: "border-gray-300"
			};
		};
		if ((isEditing)) return "<div class=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4 " + priorityColor + "\">\n\t\t\t\t\t<form phx-submit=\"save_todo\" class=\"space-y-4\">\n\t\t\t\t\t\t<input type=\"hidden\" name=\"id\" value=\"" + todo.id + "\" />\n\t\t\t\t\t\t<input type=\"text\" name=\"title\" value=\"" + todo.title + "\" required\n\t\t\t\t\t\t\tclass=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\" />\n\t\t\t\t\t\t<textarea name=\"description\" rows=\"2\"\n\t\t\t\t\t\t\tclass=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\">" + todo.description + "</textarea>\n\t\t\t\t\t\t<div class=\"flex space-x-2\">\n\t\t\t\t\t\t\t<button type=\"submit\" class=\"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600\">\n\t\t\t\t\t\t\t\tSave\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type=\"button\" phx-click=\"cancel_edit\" class=\"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400\">\n\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>" else {
			var completedClass = if ((todo.completed)) "opacity-60" else "";
			var textDecoration = if ((todo.completed)) "line-through" else "";
			var checkmark = if ((todo.completed)) "<span class=\"text-green-500\">‚úì</span>" else "";
			return "<div class=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4 " + priorityColor + " " + completedClass + " transition-all hover:shadow-xl\">\n\t\t\t\t\t<div class=\"flex items-start space-x-4\">\n\t\t\t\t\t\t<!-- Checkbox -->\n\t\t\t\t\t\t<button phx-click=\"toggle_todo\" phx-value-id=\"" + todo.id + "\"\n\t\t\t\t\t\t\tclass=\"mt-1 w-6 h-6 rounded border-2 border-gray-300 dark:border-gray-600 flex items-center justify-center hover:border-blue-500 transition-colors\">\n\t\t\t\t\t\t\t" + checkmark + "\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- Content -->\n\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-800 dark:text-white " + textDecoration + "\">\n\t\t\t\t\t\t\t\t" + todo.title + "\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t" + (if ((todo.description != null && todo.description != "")) "<p class=\"text-gray-600 dark:text-gray-400 mt-1 " + textDecoration + "\">" + todo.description + "</p>" else "") + "\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<!-- Meta info -->\n\t\t\t\t\t\t\t<div class=\"flex flex-wrap gap-2 mt-3\">\n\t\t\t\t\t\t\t\t<span class=\"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded text-xs\">\n\t\t\t\t\t\t\t\t\tPriority: " + todo.priority + "\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t" + (if ((todo.dueDate != null)) "<span class=\"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded text-xs\">Due: " + (if ((todo.dueDate == null)) "null" else {
				var this1 = todo.dueDate;
				this1.to_iso8601();
			}) + "</span>" else "") + "\n\t\t\t\t\t\t\t\t" + TodoAppWeb.TodoLive.renderTags(todo.tags) + "\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- Actions -->\n\t\t\t\t\t\t<div class=\"flex space-x-2\">\n\t\t\t\t\t\t\t<button phx-click=\"edit_todo\" phx-value-id=\"" + todo.id + "\"\n\t\t\t\t\t\t\t\tclass=\"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors\">\n\t\t\t\t\t\t\t\t‚úèÔ∏è\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button phx-click=\"delete_todo\" phx-value-id=\"" + todo.id + "\"\n\t\t\t\t\t\t\t\tdata-confirm=\"Are you sure?\"\n\t\t\t\t\t\t\t\tclass=\"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors\">\n\t\t\t\t\t\t\t\tüóëÔ∏è\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>";
		};
	}

	@:keep
	static function renderTags(tags:Array<String>) {
		if ((tags == null || tags.length == 0)) return "";
		var tagElements = [];
		{
			var _g = 0;
			while ((_g < tags.length)) {
				var tag = tags[_g];
				++ _g;
				tagElements.push("<button phx-click=\"toggle_tag\" phx-value-tag=\"" + tag + "\" class=\"px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 rounded text-xs hover:bg-blue-200\">#" + tag + "</button>");
			};
		};
		return tagElements.join("");
	}

	@:keep
	static function filterTodos(todos:Array<TodoApp.Todo>, filter:String, searchQuery:String) {
		var filtered = todos;
		filtered = @:ast(switch (filter) {
	case "active":
		filtered.filter(function(t) return !t.completed);	
	case "completed":
		filtered.filter(function(t) return t.completed);	
	case _:
		filtered;	
}) switch ((filter)) {
			case "active": filtered.filter(function(t:TodoApp.Todo) {
				return ! t.completed;
			});
			case "completed": filtered.filter(function(t:TodoApp.Todo) {
				return t.completed;
			});
			default: filtered
		};
		if ((searchQuery != null && searchQuery != "")) {
			var query = __elixir__("String.downcase({0})", searchQuery);
			filtered = filtered.filter(function(t:TodoApp.Todo) {
				return {
					var _this = {
						var _this = t.title;
						__elixir__("String.downcase({0})", _this);
					};
					__elixir__("case :binary.match({0}, {1}) do\n                {pos, _} -> pos\n                nil -> -1\n            end", _this, query);
				} >= 0 || t.description != null && {
					var _this = {
						var _this = t.description;
						__elixir__("String.downcase({0})", _this);
					};
					__elixir__("case :binary.match({0}, {1}) do\n                {pos, _} -> pos\n                nil -> -1\n            end", _this, query);
				} >= 0;
			});
		};
		return filtered;
	}

	@:keep
	static function filterAndSortTodos(todos:Array<TodoApp.Todo>, filter:String, sortBy:String, searchQuery:String) {
		var filtered = TodoAppWeb.TodoLive.filterTodos(todos, filter, searchQuery);
		return filtered;
	}
}