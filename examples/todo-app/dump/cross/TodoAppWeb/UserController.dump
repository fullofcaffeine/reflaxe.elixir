@:realPath("controllers.UserController") @:used @:keep @:native("TodoAppWeb.UserController") @:controller
class TodoAppWeb.UserController {

	@:keep
	static function generateUniqueId() {
		var timestamp = _Date.Date_Impl_.getTime(cast DateTime.utc_now());
		var random = {
			var v = __elixir__(":rand.uniform()") * 10000;
			__elixir__("floor({0})", v);
		};
		return "" + timestamp + "_" + random;
	}

	@:keep
	public static function index(conn:plug.Conn<controllers.IndexParams>, params:controllers.IndexParams) {
		var users = contexts.Users.listUsers(null);
		return __elixir__("Phoenix.Controller.json({0}, {1})", cast conn, cast {users : users});
	}

	@:keep
	public static function show(conn:plug.Conn<controllers.ShowParams>, params:controllers.ShowParams) {
		var userId = Std.parseInt(params.id);
		var user = contexts.Users.getUserSafe(userId);
		if ((user != null)) return __elixir__("Phoenix.Controller.json({0}, {1})", cast conn, cast {user : user}) else return {
			var this1 = cast __elixir__("Plug.Conn.put_status({0}, {1})", cast conn, 404);
			__elixir__("Phoenix.Controller.json({0}, {1})", this1, cast {error : "User not found"});
		};
	}

	@:keep
	public static function create(conn:plug.Conn<controllers.CreateParams>, params:controllers.CreateParams) {
		var result = contexts.Users.createUser(params);
		return @:ast(switch (result) {
	case Ok(user):
		conn.putStatus(201).json({ user : user, created : true, message : "User created successfully" });	
	case Error(changeset):
		conn.putStatus(422).json({ error : "Failed to create user", changeset : changeset });	
}) switch ((@:exhaustive enumIndex result)) {
			case 0: {
				var _g = result[0];
				{
					var user = _g;
					{
						var this1 = cast __elixir__("Plug.Conn.put_status({0}, {1})", cast conn, 201);
						__elixir__("Phoenix.Controller.json({0}, {1})", this1, cast {user : user, created : true, message : "User created successfully"});
					};
				};
			};
			case 1: {
				var _g = result[0];
				{
					var changeset = _g;
					{
						var this1 = cast __elixir__("Plug.Conn.put_status({0}, {1})", cast conn, 422);
						__elixir__("Phoenix.Controller.json({0}, {1})", this1, cast {error : "Failed to create user", changeset : changeset});
					};
				};
			};
		};
	}

	@:keep
	public static function update(conn:plug.Conn<controllers.UpdateParams>, params:controllers.UpdateParams) {
		var userId = Std.parseInt(params.id);
		var user = contexts.Users.getUserSafe(userId);
		if ((user == null)) return {
			var this1 = cast __elixir__("Plug.Conn.put_status({0}, {1})", cast conn, 404);
			__elixir__("Phoenix.Controller.json({0}, {1})", this1, cast {error : "User not found"});
		};
		var updateAttrs = {name : params.name, email : params.email, age : params.age, active : params.active};
		var result = contexts.Users.updateUser(user, updateAttrs);
		return @:ast(switch (result) {
	case Ok(updatedUser):
		conn.json({ user : updatedUser, updated : true, message : "User ${params.id} updated successfully" });	
	case Error(changeset):
		conn.putStatus(422).json({ error : "Failed to update user", changeset : changeset });	
}) switch ((@:exhaustive enumIndex result)) {
			case 0: {
				var _g = result[0];
				{
					var updatedUser = _g;
					{
						var data = cast {user : updatedUser, updated : true, message : "User " + params.id + " updated successfully"};
						__elixir__("Phoenix.Controller.json({0}, {1})", cast conn, data);
					};
				};
			};
			case 1: {
				var _g = result[0];
				{
					var changeset = _g;
					{
						var this1 = cast __elixir__("Plug.Conn.put_status({0}, {1})", cast conn, 422);
						__elixir__("Phoenix.Controller.json({0}, {1})", this1, cast {error : "Failed to update user", changeset : changeset});
					};
				};
			};
		};
	}

	@:keep
	public static function delete(conn:plug.Conn<controllers.DeleteParams>, params:controllers.DeleteParams) {
		var userId = Std.parseInt(params.id);
		var user = contexts.Users.getUserSafe(userId);
		if ((user == null)) return {
			var this1 = cast __elixir__("Plug.Conn.put_status({0}, {1})", cast conn, 404);
			__elixir__("Phoenix.Controller.json({0}, {1})", this1, cast {error : "User not found"});
		};
		var result = contexts.Users.deleteUser(user);
		return @:ast(switch (result) {
	case Ok(deletedUser):
		conn.json({ deleted : params.id, success : true, message : "User ${params.id} deleted successfully" });	
	case Error(changeset):
		conn.putStatus(500).json({ error : "Failed to delete user", success : false });	
}) switch ((@:exhaustive enumIndex result)) {
			case 0: {
				var _g = result[0];
				{
					var deletedUser = _g;
					{
						var data = cast {deleted : params.id, success : true, message : "User " + params.id + " deleted successfully"};
						__elixir__("Phoenix.Controller.json({0}, {1})", cast conn, data);
					};
				};
			};
			case 1: {
				var _g = result[0];
				{
					var changeset = _g;
					{
						var this1 = cast __elixir__("Plug.Conn.put_status({0}, {1})", cast conn, 500);
						__elixir__("Phoenix.Controller.json({0}, {1})", this1, cast {error : "Failed to delete user", success : false});
					};
				};
			};
		};
	}
}