   â”‚ Complete Compiler Issues Inventory & Fix Strategy for Reflaxe.Elixir v1.0                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Executive Summary                                                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ The todo-app reveals 8 distinct compiler bugs across multiple abstraction layers. Previous attempts have been circular because fixes at one layer broke others. This document provides complete context  â”‚
     â”‚ to fix all issues systematically without regression.                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸš¨ CRITICAL PRINCIPLES TO AVOID WALKING IN CIRCLES                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 1. Never Fix Symptoms - Fix Root Causes                                                                                                                                                                  â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - âŒ WRONG: Replace "g_counter" with "g" in output                                                                                                                                                        â”‚
     â”‚ - âœ… RIGHT: Fix variable mapping system that creates "g_counter" incorrectly                                                                                                                              â”‚
     â”‚ - Check: Run git log --oneline -30 to see if this was already tried                                                                                                                                      â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 2. Test After EVERY Change                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # MANDATORY after each compiler change:                                                                                                                                                                  â”‚
     â”‚ npm test  # Snapshot tests                                                                                                                                                                               â”‚
     â”‚ cd examples/todo-app && rm -rf lib/**/*.ex && npx haxe build-server.hxml && mix compile                                                                                                                  â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 3. Fix Across ALL Abstraction Layers                                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ When fixing a pattern, check ALL these locations:                                                                                                                                                        â”‚
     â”‚ - ElixirCompiler.hx - Main compilation                                                                                                                                                                   â”‚
     â”‚ - ExpressionDispatcher.hx - Expression routing                                                                                                                                                           â”‚
     â”‚ - VariableCompiler.hx - Variable handling                                                                                                                                                                â”‚
     â”‚ - ControlFlowCompiler.hx - If/while/for                                                                                                                                                                  â”‚
     â”‚ - PatternMatchingCompiler.hx - Switch/match                                                                                                                                                              â”‚
     â”‚ - LoopCompiler.hx - Loop transformations                                                                                                                                                                 â”‚
     â”‚ - DataStructureCompiler.hx - Arrays/objects                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 4. Watch for Cascade Effects                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Variable renaming affects ALL references                                                                                                                                                               â”‚
     â”‚ - Loop transformations affect variable scoping                                                                                                                                                           â”‚
     â”‚ - Pattern matching affects variable extraction                                                                                                                                                           â”‚
     â”‚ - Solution: Use VariableMappingManager for centralized tracking                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 5. Check Previous Attempts                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ git log --grep="g_counter\|temp_array\|JsonPrinter" --oneline                                                                                                                                            â”‚
     â”‚ git blame src/reflaxe/elixir/helpers/VariableCompiler.hx | grep "FIX"                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸ“‹ COMPLETE ISSUES INVENTORY                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Issue #1: JsonPrinter Y-Combinator Loop Variables (CRITICAL BLOCKER)                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ error: undefined variable "v2"                                                                                                                                                                           â”‚
     â”‚ error: undefined variable "this"                                                                                                                                                                         â”‚
     â”‚ error: undefined variable "value"                                                                                                                                                                        â”‚
     â”‚ Location: lib/haxe/format/json_printer.ex:240                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Y-combinator pattern creates variables inside function scope that aren't visible outside:                                                                                                                â”‚
     â”‚ # Variables declared but not initialized properly                                                                                                                                                        â”‚
     â”‚ i = nil; g = nil; f = nil; value = nil; empty = nil; this = nil; v2 = nil                                                                                                                                â”‚
     â”‚ loop_helper = fn loop_fn, {i, g, f, value, empty, this, v2} -> ... end                                                                                                                                   â”‚
     â”‚ # BUG: Variables undefined at initial call                                                                                                                                                               â”‚
     â”‚ {i, g, f, value, empty, this, v2} = loop_helper.(loop_helper, {i, g, f, value, empty, this, v2})                                                                                                         â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Failed Attempts                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Tried detecting Y-combinator pattern in LoopCompiler                                                                                                                                                   â”‚
     â”‚ - Attempted variable preservation in recursive calls                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Correct Fix                                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Initialize with actual values from context before loop:                                                                                                                                                  â”‚
     â”‚ i = 0                                                                                                                                                                                                    â”‚
     â”‚ g = g_counter                                                                                                                                                                                            â”‚
     â”‚ f = nil                                                                                                                                                                                                  â”‚
     â”‚ value = nil                                                                                                                                                                                              â”‚
     â”‚ empty = true  # from line 202                                                                                                                                                                            â”‚
     â”‚ this = struct  # from function parameter                                                                                                                                                                 â”‚
     â”‚ v2 = v  # from function parameter                                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #2: Enum Pattern Parameter Variable Collision                                                                                                                                                      â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ error: undefined variable "g_counter"                                                                                                                                                                    â”‚
     â”‚ warning: variable "g_array" is unused                                                                                                                                                                    â”‚
     â”‚ Location: lib/elixir/otp/type_safe_child_spec_tools.ex:26-32                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Multiple enum parameters extracted to same variable name:                                                                                                                                                â”‚
     â”‚ case 2 ->                                                                                                                                                                                                â”‚
     â”‚   g_array = elem(spec, 1)  # First param                                                                                                                                                                 â”‚
     â”‚   g_array = elem(spec, 2)  # OVERWRITES!                                                                                                                                                                 â”‚
     â”‚   port = g_array    # Wrong value                                                                                                                                                                        â”‚
     â”‚   config = g_array  # Wrong value                                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Failed Attempts                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Added containsEnumParameter detection                                                                                                                                                                  â”‚
     â”‚ - Tried preserving 'g' variable name                                                                                                                                                                     â”‚
     â”‚ - Attempted to track enum extraction index                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Correct Fix                                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Generate unique extraction variables:                                                                                                                                                                    â”‚
     â”‚ g_param_0 = elem(spec, 1)                                                                                                                                                                                â”‚
     â”‚ g_param_1 = elem(spec, 2)                                                                                                                                                                                â”‚
     â”‚ port = g_param_0                                                                                                                                                                                         â”‚
     â”‚ config = g_param_1                                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #3: TodoPubSub Enum Pattern Generation                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Generates: :todo_created  # Atom only                                                                                                                                                                    â”‚
     â”‚ Expected: {:todo_created, todo}  # Tagged tuple with data                                                                                                                                                â”‚
     â”‚ Location: lib/server/pubsub/todo_pub_sub.ex                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ construct.params.length returns 0 even for parameterized constructors                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix Attempt                                                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Added containsEnumParameter to detect parameters from case body - PARTIALLY WORKED                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Remaining Issue                                                                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Still not generating proper parameter extraction in some cases                                                                                                                                           â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #4: If-Else Variable Scoping (temp_array, temp_string)                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ warning: variable "temp_array" is unused                                                                                                                                                                 â”‚
     â”‚ warning: variable "temp_string" is unused                                                                                                                                                                â”‚
     â”‚ Location: lib/server/live/type_safe_conversions.ex:150-227                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Nested ternaries desugared to block if-else with internal assignments:                                                                                                                                   â”‚
     â”‚ if ((todos != nil)) do                                                                                                                                                                                   â”‚
     â”‚   temp_array = todos  # Scoped inside block!                                                                                                                                                             â”‚
     â”‚ else                                                                                                                                                                                                     â”‚
     â”‚   if ((base != nil)) do                                                                                                                                                                                  â”‚
     â”‚     temp_array = base.todos  # Different scope!                                                                                                                                                          â”‚
     â”‚   else                                                                                                                                                                                                   â”‚
     â”‚     temp_array = []                                                                                                                                                                                      â”‚
     â”‚   end                                                                                                                                                                                                    â”‚
     â”‚ end                                                                                                                                                                                                      â”‚
     â”‚ # temp_array undefined here!                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix Attempts                                                                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Modified VariableCompiler to detect TIf in TVar - INCOMPLETE                                                                                                                                           â”‚
     â”‚ - Added inline form for array ternaries - PARTIAL                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Correct Fix                                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Detect standalone TIf with assignments and rewrite:                                                                                                                                                      â”‚
     â”‚ temp_array = if ((todos != nil)), do: todos, else: if ((base != nil)), do: base.todos, else: []                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #5: Orphaned Enum Extraction Variables                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ g = elem(message, 0)  # Generated but never used                                                                                                                                                         â”‚
     â”‚ g_array = elem(message, 1)  # Generated but todo variable not created                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Switch on enum generates extraction even for cases that don't use parameters                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix Attempts                                                                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Added -reflaxe.unused metadata detection                                                                                                                                                               â”‚
     â”‚ - Created RemoveOrphanedEnumParametersImpl preprocessor                                                                                                                                                  â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Status                                                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ PARTIALLY FIXED but still generates some orphaned extractions                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #6: Variable Name Collision (_g vs g vs g_counter vs g_array)                                                                                                                                      â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Variable 'g' used for both counter and array                                                                                                                                                             â”‚
     â”‚ Variable '_g' transformed inconsistently                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Multiple compiler layers independently transform variable names:                                                                                                                                         â”‚
     â”‚ - VariableCompiler removes underscores                                                                                                                                                                   â”‚
     â”‚ - VariableMappingManager tracks transformations                                                                                                                                                          â”‚
     â”‚ - LoopCompiler renames for collision avoidance                                                                                                                                                           â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix Attempts                                                                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Added variableRenameMap tracking                                                                                                                                                                       â”‚
     â”‚ - Created VariableMappingManager centralization                                                                                                                                                          â”‚
     â”‚ - Special-cased 'g' variable preservation                                                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Remaining Issues                                                                                                                                                                                         â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Still getting inconsistent mappings in some contexts                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #7: Array Desugaring Variable Mapping                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ _g_array becomes g but should be g_array                                                                                                                                                                 â”‚
     â”‚ Loop counter and array accumulator collision                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Haxe desugars array operations (map/filter) creating:                                                                                                                                                    â”‚
     â”‚ - _g for accumulator array                                                                                                                                                                               â”‚
     â”‚ - _g for loop counter (collision!)                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix                                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Rename on initialization type:                                                                                                                                                                           â”‚
     â”‚ - TArrayDecl([]) â†’ _g_array                                                                                                                                                                              â”‚
     â”‚ - TConst(TInt(0)) â†’ _g_counter                                                                                                                                                                           â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Status                                                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ MOSTLY FIXED but edge cases remain                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #8: Reflect.fields Y-Combinator Pattern                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Similar to JsonPrinter - loop variables not properly initialized                                                                                                                                         â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Same Y-combinator transformation issue                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Status                                                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Will be fixed by same solution as JsonPrinter                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸ—ï¸ ARCHITECTURAL FIXES REQUIRE                                                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 1. Centralized Variable Mapping System                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Problem: Multiple layers independently manage variable names                                                                                                                                             â”‚
     â”‚ Solution: All variable transformations go through VariableMappingManager                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ // EVERY variable transformation MUST use:                                                                                                                                                               â”‚
     â”‚ variableMappingManager.registerTransformation(original, transformed);                                                                                                                                    â”‚
     â”‚ var finalName = variableMappingManager.getCanonicalName(original);                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 2. Context-Aware Compilation State                                                                                                                                                                       â”‚
        â”‚ Complete Compiler Issues Inventory & Fix Strategy for Reflaxe.Elixir v1.0                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Executive Summary                                                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ The todo-app reveals 8 distinct compiler bugs across multiple abstraction layers. Previous attempts have been circular because fixes at one layer broke others. This document provides complete context  â”‚
     â”‚ to fix all issues systematically without regression.                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸš¨ CRITICAL PRINCIPLES TO AVOID WALKING IN CIRCLES                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 1. Never Fix Symptoms - Fix Root Causes                                                                                                                                                                  â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - âŒ WRONG: Replace "g_counter" with "g" in output                                                                                                                                                        â”‚
     â”‚ - âœ… RIGHT: Fix variable mapping system that creates "g_counter" incorrectly                                                                                                                              â”‚
     â”‚ - Check: Run git log --oneline -30 to see if this was already tried                                                                                                                                      â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 2. Test After EVERY Change                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # MANDATORY after each compiler change:                                                                                                                                                                  â”‚
     â”‚ npm test  # Snapshot tests                                                                                                                                                                               â”‚
     â”‚ cd examples/todo-app && rm -rf lib/**/*.ex && npx haxe build-server.hxml && mix compile                                                                                                                  â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 3. Fix Across ALL Abstraction Layers                                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ When fixing a pattern, check ALL these locations:                                                                                                                                                        â”‚
     â”‚ - ElixirCompiler.hx - Main compilation                                                                                                                                                                   â”‚
     â”‚ - ExpressionDispatcher.hx - Expression routing                                                                                                                                                           â”‚
     â”‚ - VariableCompiler.hx - Variable handling                                                                                                                                                                â”‚
     â”‚ - ControlFlowCompiler.hx - If/while/for                                                                                                                                                                  â”‚
     â”‚ - PatternMatchingCompiler.hx - Switch/match                                                                                                                                                              â”‚
     â”‚ - LoopCompiler.hx - Loop transformations                                                                                                                                                                 â”‚
     â”‚ - DataStructureCompiler.hx - Arrays/objects                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 4. Watch for Cascade Effects                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Variable renaming affects ALL references                                                                                                                                                               â”‚
     â”‚ - Loop transformations affect variable scoping                                                                                                                                                           â”‚
     â”‚ - Pattern matching affects variable extraction                                                                                                                                                           â”‚
     â”‚ - Solution: Use VariableMappingManager for centralized tracking                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 5. Check Previous Attempts                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ git log --grep="g_counter\|temp_array\|JsonPrinter" --oneline                                                                                                                                            â”‚
     â”‚ git blame src/reflaxe/elixir/helpers/VariableCompiler.hx | grep "FIX"                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸ“‹ COMPLETE ISSUES INVENTORY                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Issue #1: JsonPrinter Y-Combinator Loop Variables (CRITICAL BLOCKER)                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ error: undefined variable "v2"                                                                                                                                                                           â”‚
     â”‚ error: undefined variable "this"                                                                                                                                                                         â”‚
     â”‚ error: undefined variable "value"                                                                                                                                                                        â”‚
     â”‚ Location: lib/haxe/format/json_printer.ex:240                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Y-combinator pattern creates variables inside function scope that aren't visible outside:                                                                                                                â”‚
     â”‚ # Variables declared but not initialized properly                                                                                                                                                        â”‚
     â”‚ i = nil; g = nil; f = nil; value = nil; empty = nil; this = nil; v2 = nil                                                                                                                                â”‚
     â”‚ loop_helper = fn loop_fn, {i, g, f, value, empty, this, v2} -> ... end                                                                                                                                   â”‚
     â”‚ # BUG: Variables undefined at initial call                                                                                                                                                               â”‚
     â”‚ {i, g, f, value, empty, this, v2} = loop_helper.(loop_helper, {i, g, f, value, empty, this, v2})                                                                                                         â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Failed Attempts                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Tried detecting Y-combinator pattern in LoopCompiler                                                                                                                                                   â”‚
     â”‚ - Attempted variable preservation in recursive calls                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Correct Fix                                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Initialize with actual values from context before loop:                                                                                                                                                  â”‚
     â”‚ i = 0                                                                                                                                                                                                    â”‚
     â”‚ g = g_counter                                                                                                                                                                                            â”‚
     â”‚ f = nil                                                                                                                                                                                                  â”‚
     â”‚ value = nil                                                                                                                                                                                              â”‚
     â”‚ empty = true  # from line 202                                                                                                                                                                            â”‚
     â”‚ this = struct  # from function parameter                                                                                                                                                                 â”‚
     â”‚ v2 = v  # from function parameter                                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #2: Enum Pattern Parameter Variable Collision                                                                                                                                                      â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ error: undefined variable "g_counter"                                                                                                                                                                    â”‚
     â”‚ warning: variable "g_array" is unused                                                                                                                                                                    â”‚
     â”‚ Location: lib/elixir/otp/type_safe_child_spec_tools.ex:26-32                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Multiple enum parameters extracted to same variable name:                                                                                                                                                â”‚
     â”‚ case 2 ->                                                                                                                                                                                                â”‚
     â”‚   g_array = elem(spec, 1)  # First param                                                                                                                                                                 â”‚
     â”‚   g_array = elem(spec, 2)  # OVERWRITES!                                                                                                                                                                 â”‚
     â”‚   port = g_array    # Wrong value                                                                                                                                                                        â”‚
     â”‚   config = g_array  # Wrong value                                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Failed Attempts                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Added containsEnumParameter detection                                                                                                                                                                  â”‚
     â”‚ - Tried preserving 'g' variable name                                                                                                                                                                     â”‚
     â”‚ - Attempted to track enum extraction index                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Correct Fix                                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Generate unique extraction variables:                                                                                                                                                                    â”‚
     â”‚ g_param_0 = elem(spec, 1)                                                                                                                                                                                â”‚
     â”‚ g_param_1 = elem(spec, 2)                                                                                                                                                                                â”‚
     â”‚ port = g_param_0                                                                                                                                                                                         â”‚
     â”‚ config = g_param_1                                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #3: TodoPubSub Enum Pattern Generation                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Generates: :todo_created  # Atom only                                                                                                                                                                    â”‚
     â”‚ Expected: {:todo_created, todo}  # Tagged tuple with data                                                                                                                                                â”‚
     â”‚ Location: lib/server/pubsub/todo_pub_sub.ex                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ construct.params.length returns 0 even for parameterized constructors                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix Attempt                                                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Added containsEnumParameter to detect parameters from case body - PARTIALLY WORKED                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Remaining Issue                                                                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Still not generating proper parameter extraction in some cases                                                                                                                                           â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #4: If-Else Variable Scoping (temp_array, temp_string)                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ warning: variable "temp_array" is unused                                                                                                                                                                 â”‚
     â”‚ warning: variable "temp_string" is unused                                                                                                                                                                â”‚
     â”‚ Location: lib/server/live/type_safe_conversions.ex:150-227                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Nested ternaries desugared to block if-else with internal assignments:                                                                                                                                   â”‚
     â”‚ if ((todos != nil)) do                                                                                                                                                                                   â”‚
     â”‚   temp_array = todos  # Scoped inside block!                                                                                                                                                             â”‚
     â”‚ else                                                                                                                                                                                                     â”‚
     â”‚   if ((base != nil)) do                                                                                                                                                                                  â”‚
     â”‚     temp_array = base.todos  # Different scope!                                                                                                                                                          â”‚
     â”‚   else                                                                                                                                                                                                   â”‚
     â”‚     temp_array = []                                                                                                                                                                                      â”‚
     â”‚   end                                                                                                                                                                                                    â”‚
     â”‚ end                                                                                                                                                                                                      â”‚
     â”‚ # temp_array undefined here!                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix Attempts                                                                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Modified VariableCompiler to detect TIf in TVar - INCOMPLETE                                                                                                                                           â”‚
     â”‚ - Added inline form for array ternaries - PARTIAL                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Correct Fix                                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Detect standalone TIf with assignments and rewrite:                                                                                                                                                      â”‚
     â”‚ temp_array = if ((todos != nil)), do: todos, else: if ((base != nil)), do: base.todos, else: []                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #5: Orphaned Enum Extraction Variables                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ g = elem(message, 0)  # Generated but never used                                                                                                                                                         â”‚
     â”‚ g_array = elem(message, 1)  # Generated but todo variable not created                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Switch on enum generates extraction even for cases that don't use parameters                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix Attempts                                                                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Added -reflaxe.unused metadata detection                                                                                                                                                               â”‚
     â”‚ - Created RemoveOrphanedEnumParametersImpl preprocessor                                                                                                                                                  â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Status                                                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ PARTIALLY FIXED but still generates some orphaned extractions                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #6: Variable Name Collision (_g vs g vs g_counter vs g_array)                                                                                                                                      â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Variable 'g' used for both counter and array                                                                                                                                                             â”‚
     â”‚ Variable '_g' transformed inconsistently                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Multiple compiler layers independently transform variable names:                                                                                                                                         â”‚
     â”‚ - VariableCompiler removes underscores                                                                                                                                                                   â”‚
     â”‚ - VariableMappingManager tracks transformations                                                                                                                                                          â”‚
     â”‚ - LoopCompiler renames for collision avoidance                                                                                                                                                           â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix Attempts                                                                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Added variableRenameMap tracking                                                                                                                                                                       â”‚
     â”‚ - Created VariableMappingManager centralization                                                                                                                                                          â”‚
     â”‚ - Special-cased 'g' variable preservation                                                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Remaining Issues                                                                                                                                                                                         â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Still getting inconsistent mappings in some contexts                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #7: Array Desugaring Variable Mapping                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ _g_array becomes g but should be g_array                                                                                                                                                                 â”‚
     â”‚ Loop counter and array accumulator collision                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Haxe desugars array operations (map/filter) creating:                                                                                                                                                    â”‚
     â”‚ - _g for accumulator array                                                                                                                                                                               â”‚
     â”‚ - _g for loop counter (collision!)                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Previous Fix                                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Rename on initialization type:                                                                                                                                                                           â”‚
     â”‚ - TArrayDecl([]) â†’ _g_array                                                                                                                                                                              â”‚
     â”‚ - TConst(TInt(0)) â†’ _g_counter                                                                                                                                                                           â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Status                                                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ MOSTLY FIXED but edge cases remain                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ Issue #8: Reflect.fields Y-Combinator Pattern                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Symptoms                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Similar to JsonPrinter - loop variables not properly initialized                                                                                                                                         â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Root Cause                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Same Y-combinator transformation issue                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Status                                                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Will be fixed by same solution as JsonPrinter                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸ—ï¸ ARCHITECTURAL FIXES REQUIRE                                                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 1. Centralized Variable Mapping System                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Problem: Multiple layers independently manage variable names                                                                                                                                             â”‚
     â”‚ Solution: All variable transformations go through VariableMappingManager                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ // EVERY variable transformation MUST use:                                                                                                                                                               â”‚
     â”‚ variableMappingManager.registerTransformation(original, transformed);                                                                                                                                    â”‚
     â”‚ var finalName = variableMappingManager.getCanonicalName(original);                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 2. Context-Aware Compilation State                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Problem: Compilation context lost between expression processing                                                                                                                                          â”‚
     â”‚ Solution: Thread context through all compilation methods                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ class CompilationContext {                                                                                                                                                                               â”‚
     â”‚   var isInLoop: Bool;                                                                                                                                                                                    â”‚
     â”‚   var isInSwitch: Bool;                                                                                                                                                                                  â”‚
     â”‚   var parentBlockVariables: Map<String, String>;                                                                                                                                                         â”‚
     â”‚   var enumExtractionIndex: Int;                                                                                                                                                                          â”‚
     â”‚ }                                                                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 3. Pattern Detection Registry                                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Problem: Same patterns detected differently across compilers                                                                                                                                             â”‚
     â”‚ Solution: Centralized pattern detection                                                                                                                                                                  â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ class PatternRegistry {                                                                                                                                                                                  â”‚
     â”‚   static function isYCombinator(expr: TypedExpr): Bool;                                                                                                                                                  â”‚
     â”‚   static function isArrayDesugaring(expr: TypedExpr): Bool;                                                                                                                                              â”‚
     â”‚   static function isEnumExtraction(expr: TypedExpr): Bool;                                                                                                                                               â”‚
     â”‚ }                                                                                                                                                                                                        â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸ› ï¸ FIX IMPLEMENTATION ORDE                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Phase 1: Critical Runtime Blockers                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 1. JsonPrinter Y-combinator - App won't run without this                                                                                                                                                 â”‚
     â”‚ 2. Enum parameter extraction collision - Causes runtime errors                                                                                                                                           â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Phase 2: Compilation Warnings                                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 3. If-else variable scoping - Fix temp variable warnings                                                                                                                                                 â”‚
     â”‚ 4. Orphaned enum variables - Clean up unused extractions                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Phase 3: Architecture Cleanup                                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 5. Centralize variable mapping - Prevent future collisions                                                                                                                                               â”‚
     â”‚ 6. Add compilation context - Maintain state properly                                                                                                                                                     â”‚
     â”‚ 7. Create pattern registry - DRY pattern detection                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸ” TESTING EACH FIX                                                                                                                                                                                      â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Test Protocol for EVERY Change                                                                                                                                                                           â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 1. Run snapshot tests                                                                                                                                                                                  â”‚
     â”‚ npm test                                                                                                                                                                                                 â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 2. Check specific test if exists                                                                                                                                                                       â”‚
     â”‚ haxe test/Test.hxml test=JsonPrinter                                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 3. Test todo-app compilation                                                                                                                                                                           â”‚
     â”‚ cd examples/todo-app                                                                                                                                                                                     â”‚
     â”‚ rm -rf lib/**/*.ex                                                                                                                                                                                       â”‚
     â”‚ npx haxe build-server.hxml                                                                                                                                                                               â”‚
     â”‚ mix compile --force 2>&1 | tee /tmp/compile.log                                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 4. Check for regressions                                                                                                                                                                               â”‚
     â”‚ grep -E "error:|undefined variable" /tmp/compile.log                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 5. Test runtime (after fixing blockers)                                                                                                                                                                â”‚
     â”‚ mix phx.server &                                                                                                                                                                                         â”‚
     â”‚ sleep 3                                                                                                                                                                                                  â”‚
     â”‚ curl localhost:4000                                                                                                                                                                                      â”‚
     â”‚ pkill -f beam                                                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Regression Prevention                                                                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - NEVER commit without full test suite passing                                                                                                                                                           â”‚
     â”‚ - Add snapshot test for each fixed pattern                                                                                                                                                               â”‚
     â”‚ - Document WHY fix works in code comments                                                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ âš ï¸ CRITICAL PITFALLS TO AVOID                                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 1. The g Variable Trap                                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - 'g' is used for BOTH enum switch values AND loop counters                                                                                                                                              â”‚
     â”‚ - NEVER rename 'g' to 'g_counter' globally                                                                                                                                                               â”‚
     â”‚ - Must detect context (enum vs loop)                                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 2. The Cascading Rename Problem                                                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Renaming variable at declaration affects ALL references                                                                                                                                                â”‚
     â”‚ - Must track through variableRenameMap                                                                                                                                                                   â”‚
     â”‚ - Test with complex nested expressions                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 3. The Scoping Assumption                                                                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Elixir variables in blocks are NOT visible outside                                                                                                                                                     â”‚
     â”‚ - JavaScript/Haxe developers assume they are                                                                                                                                                             â”‚
     â”‚ - Always use inline if for assignments                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 4. The Pattern Matching Assumption                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - construct.params.length is UNRELIABLE                                                                                                                                                                  â”‚
     â”‚ - Must detect from actual AST usage                                                                                                                                                                      â”‚
     â”‚ - Check for TEnumParameter expressions                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ 5. The Fix-One-Break-Another Cycle                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Variable fixes break pattern matching                                                                                                                                                                  â”‚
     â”‚ - Pattern fixes break loop compilation                                                                                                                                                                   â”‚
     â”‚ - Loop fixes break variable scoping                                                                                                                                                                      â”‚
     â”‚ - Solution: Test ALL patterns after EACH change                                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸ“š KEY LEARNINGS & PATTERNS                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Pattern: Y-Combinator Transformation                                                                                                                                                                     â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ // Haxe while loop                                                                                                                                                                                       â”‚
     â”‚ while (i < len) { /* mutate state */ }                                                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ // Becomes Elixir recursion                                                                                                                                                                              â”‚
     â”‚ loop_fn = fn(loop_fn, state) ->                                                                                                                                                                          â”‚
     â”‚   if condition do                                                                                                                                                                                        â”‚
     â”‚     loop_fn.(loop_fn, new_state)                                                                                                                                                                         â”‚
     â”‚   else                                                                                                                                                                                                   â”‚
     â”‚     state                                                                                                                                                                                                â”‚
     â”‚   end                                                                                                                                                                                                    â”‚
     â”‚ end                                                                                                                                                                                                      â”‚
     â”‚ Key: Must initialize state BEFORE first call                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Pattern: Enum Parameter Extraction                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # Elixir enum representation                                                                                                                                                                             â”‚
     â”‚ {:constructor_tag, param1, param2}                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # Extraction pattern                                                                                                                                                                                     â”‚
     â”‚ tag = elem(enum_value, 0)                                                                                                                                                                                â”‚
     â”‚ param1 = elem(enum_value, 1)                                                                                                                                                                             â”‚
     â”‚ param2 = elem(enum_value, 2)                                                                                                                                                                             â”‚
     â”‚ Key: Each extraction needs unique variable                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Pattern: Ternary to If-Else                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ // Nested ternary                                                                                                                                                                                        â”‚
     â”‚ x != null ? x : (y != null ? y : default)                                                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ // Must become inline                                                                                                                                                                                    â”‚
     â”‚ x = if x != nil, do: x, else: if y != nil, do: y, else: default                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ // NOT block form (causes scoping issues)                                                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸŽ¯ SUCCESS CRITERIA                                                                                                                                                                                      â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Minimum for v1.0                                                                                                                                                                                         â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Todo-app compiles without errors                                                                                                                                                                       â”‚
     â”‚ - Phoenix server starts successfully                                                                                                                                                                     â”‚
     â”‚ - Homepage loads without crashes                                                                                                                                                                         â”‚
     â”‚ - No undefined variable errors                                                                                                                                                                           â”‚
     â”‚ - Less than 10 warnings total                                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Nice to Have                                                                                                                                                                                             â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - Zero compilation warnings                                                                                                                                                                              â”‚
     â”‚ - All tests pass                                                                                                                                                                                         â”‚
     â”‚ - Clean variable naming throughout                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸ“ FILES REQUIRING CHANGES                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Primary Fixes                                                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - /src/reflaxe/elixir/helpers/LoopCompiler.hx - Y-combinator initialization                                                                                                                              â”‚
     â”‚ - /src/reflaxe/elixir/helpers/PatternMatchingCompiler.hx - Enum extraction                                                                                                                               â”‚
     â”‚ - /src/reflaxe/elixir/helpers/ControlFlowCompiler.hx - If-else scoping                                                                                                                                   â”‚
     â”‚ - /src/reflaxe/elixir/helpers/VariableCompiler.hx - Variable declarations                                                                                                                                â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Supporting Changes                                                                                                                                                                                       â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - /src/reflaxe/elixir/helpers/VariableMappingManager.hx - Centralized tracking                                                                                                                           â”‚
     â”‚ - /src/reflaxe/elixir/helpers/ExpressionDispatcher.hx - Context threading                                                                                                                                â”‚
     â”‚ - /src/reflaxe/elixir/ElixirCompiler.hx - Main coordination                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ Test Files                                                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ - /test/tests/JsonPrinter/ - Add test case                                                                                                                                                               â”‚
     â”‚ - /test/tests/EnumPatternExtraction/ - Add test case                                                                                                                                                     â”‚
     â”‚ - /test/tests/TernaryScoping/ - Add test case                                                                                                                                                            â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ ---                                                                                                                                                                                                      â”‚
     â”‚ ðŸš€ NEXT SESSION QUICK START                                                                                                                                                                              â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 1. Check current state                                                                                                                                                                                 â”‚
     â”‚ cd /Users/fullofcaffeine/workspace/code/haxe.elixir                                                                                                                                                      â”‚
     â”‚ git status                                                                                                                                                                                               â”‚
     â”‚ git log --oneline -10                                                                                                                                                                                    â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 2. See what's broken                                                                                                                                                                                   â”‚
     â”‚ cd examples/todo-app                                                                                                                                                                                     â”‚
     â”‚ mix compile 2>&1 | grep -E "error:|warning:" | head -20                                                                                                                                                  â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 3. Start with JsonPrinter fix                                                                                                                                                                          â”‚
     â”‚ grep -n "loop_helper\|{i, g, f, value" lib/haxe/format/json_printer.ex                                                                                                                                   â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 4. Fix in LoopCompiler.hx                                                                                                                                                                              â”‚
     â”‚ vim src/reflaxe/elixir/helpers/LoopCompiler.hx                                                                                                                                                           â”‚
     â”‚ # Look for Y-combinator pattern generation                                                                                                                                                               â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ # 5. Test immediately                                                                                                                                                                                    â”‚
     â”‚ rm -rf lib/**/*.ex && npx haxe build-server.hxml && mix compile                                                                                                                                          â”‚
     â”‚                                                                                                                                                                                                          â”‚
     â”‚ This plan captures ALL issues, patterns, pitfalls, and provides a systematic approach to achieving v1.0 readiness without walking in circles!                                                            â”‚
     â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
