class reflaxe.helpers.NameMetaHelper {

	@:value([])
	static var nativeNameOverrides:Map<String, String> = {
		{};
		new haxe.ds.StringMap();
	};

	public static function hasMeta(v:reflaxe.helpers.NameAndMeta, metaName:String) {
		return v.meta != null && v.meta.has != null && v.meta.has(metaName);
	}

	public static function getNameOrMeta(v:reflaxe.helpers.NameAndMeta, metaName:String) {
		if (reflaxe.helpers.NameMetaHelper.hasMeta(v, metaName)) {
			var result = reflaxe.helpers.NullableMetaAccessHelper.extractStringFromFirstMeta(v.meta, metaName, null);
			if (result != null) {
				return result;
			};
		};
		return v.name;
	}

	public static function getNameOrNative(v:reflaxe.helpers.NameAndMeta) {
		return reflaxe.helpers.NameMetaHelper.getNameOrMeta(v, ":native");
	}

	public static function getNameOrNativeName(v:reflaxe.helpers.NameAndMeta) {
		if (reflaxe.helpers.NameMetaHelper.hasMeta(v, ":nativeName")) {
			var result = reflaxe.helpers.NullableMetaAccessHelper.extractParamsFromFirstMeta(v.meta, ":nativeName");
			if (result != null && result.length > 1) {
				var id = result[1];
				if ({
					var this = reflaxe.helpers.NameMetaHelper.nativeNameOverrides;
					cast this.exists(id);
				}) {
					return {
						var maybe = {
							var this = reflaxe.helpers.NameMetaHelper.nativeNameOverrides;
							cast this.get(id);
						};
						cast {
							if (maybe == null) {
								throw "Trusted on null value.";
							};
							@:nullSafety(Off) maybe;
						};
					};
				};
			};
		};
		return reflaxe.helpers.NameMetaHelper.getNameOrMeta(v, ":nativeName");
	}

	public static function getFieldAccessNameMeta(fa:haxe.macro.FieldAccess) {
		return @:ast(switch (fa) {
	case FInstance(_, _, classFieldRef):
		classFieldRef.get();	
	case FStatic(_, classFieldRef):
		classFieldRef.get();	
	case FAnon(classFieldRef):
		classFieldRef.get();	
	case FClosure(_, classFieldRef):
		classFieldRef.get();	
	case FEnum(_, enumField):
		enumField;	
	case FDynamic(s):
		{ name : s, meta : null };	
}) switch (@:exhaustive enumIndex fa) {
			case 0: {
				var ` = fa[0];
				var ` = fa[1];
				var ` = fa[2];
				{
					var classFieldRef = `;
					{
						classFieldRef.get();
					};
				};
			};
			case 1: {
				var ` = fa[0];
				var ` = fa[1];
				{
					var classFieldRef = `;
					{
						classFieldRef.get();
					};
				};
			};
			case 2: {
				var ` = fa[0];
				{
					var classFieldRef = `;
					{
						classFieldRef.get();
					};
				};
			};
			case 3: {
				var ` = fa[0];
				{
					var s = `;
					{
						{name : s, meta : null};
					};
				};
			};
			case 4: {
				var ` = fa[0];
				var ` = fa[1];
				{
					var classFieldRef = `;
					{
						classFieldRef.get();
					};
				};
			};
			case 5: {
				var ` = fa[0];
				var ` = fa[1];
				{
					var enumField = `;
					{
						enumField;
					};
				};
			};
		};
	}

	public static function setNativeNameOverride(id:String, overrideValue:String) {
		{
			var this = reflaxe.helpers.NameMetaHelper.nativeNameOverrides;
			cast this.set(id, overrideValue);
		};
	}

	public static function getNativeNameOverride(id:String) {
		return {
			var this = reflaxe.helpers.NameMetaHelper.nativeNameOverrides;
			cast this.get(id);
		};
	}
}