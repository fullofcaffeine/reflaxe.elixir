@:directlyUsed @:used @:coreApi
class StringBuf {

	public function new() {
		this.parts = [];
	}

	var parts:Array<String>;

	public var length(get,never):Int;

	function get_length() {
		var joined = this.parts.join("");
		return joined.length;
	}

	public function add<T>(x:add.T) {
		var str = if ((x == null)) "null" else Std.string(x);
		this.parts.push(str);
	}

	public function addChar(c:Int) {
		this.parts.push(String.fromCharCode(c));
	}

	public function addSub(s:String, pos:Int, len:Null<Int> = null) {
		if ((s == null)) return;
		var substr = if ((len == null)) s.substr(pos) else s.substr(pos, len);
		this.parts.push(substr);
	}

	@:has_untyped
	public function toString() {
		return __elixir__("IO.iodata_to_binary({0})", this.parts);
	}
}