package;

/**
 * Test: @:changeset annotation parameter extraction
 *
 * This test validates that @:changeset([castFields], [requiredFields])
 * properly generates an Ecto changeset function with:
 * - cast/3 with the specified fields (converted to snake_case atoms)
 * - validate_required/2 with the specified required fields
 *
 * The @:changeset annotation format is:
 * @:changeset(["field1", "field2"], ["required1"])
 *   - First array: fields to cast
 *   - Second array: fields that are required
 */
@:native("TestApp.Product")
@:schema("products")
@:timestamps
@:changeset(["title", "description", "price", "stockCount", "categoryId"], ["title", "price"])
class Product {
    @:primary_key
    public var id: Int;

    public var title: String;
    public var description: String;
    public var price: Float;
    public var stockCount: Int;
    public var categoryId: Int;

    // Extern declaration for type safety - tells Haxe the function exists
    // The actual implementation is auto-generated by @:changeset annotation
    extern public static function changeset(product: Product, attrs: Dynamic): Dynamic;
}

class Main {
    public static function main() {
        // The test validates that Product module compiles with auto-generated changeset
        trace("Product schema with changeset annotation compiled successfully");
    }
}
