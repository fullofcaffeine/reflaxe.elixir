class reflaxe.elixir.ast.transformers.ChangesetOptionFilterTransforms {

	public static function filterValidateLengthOptionsPass(ast:reflaxe.elixir.ast.ElixirAST) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(ast, function(n:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (n.def) {
	case ERemoteCall(mod, fn, args) if (isChangesetValidateLength(mod, fn, args)):
		var a = args.copy();
		if (a.length >= 3) switch (a[2].def) {
			case EKeywordList(pairs):
				var listExpr = makeAST(EKeywordList(pairs));
				var filterFn = makeAST(EFn([{ args : [PTuple([PWildcard, PVar("v")])], body : makeAST(EBinary(NotEqual, makeAST(EVar("v")), makeAST(ENil))) }]));
				var filtered = makeAST(ERemoteCall(makeAST(EVar("Enum")), "filter", [listExpr, filterFn]));
				a[2] = filtered;
				makeASTWithMeta(ERemoteCall(mod, fn, a), n.metadata, n.pos);			
			default:
				n;			
		} else n;	
	default:
		n;	
}) {
				var ` = n.def;
				if (enumIndex ` == 24) {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					{
						var mod = `;
						var fn = `;
						var args = `;
						if (if (fn != "validate_length") {
							false;
						} else {
							@:ast(switch (mod.def) {
	case EVar(name):
		name != null && (name == "Ecto.Changeset" || name.indexOf("Ecto.Changeset") != -1);	
	default:
		false;	
}) {
								var ` = mod.def;
								if (enumIndex ` == 38) {
									var ` = `[0];
									{
										var name = `;
										{
											name != null && (name == "Ecto.Changeset" || name.indexOf("Ecto.Changeset", null) != -1);
										};
									};
								} else {
									false;
								};
							};
						}) {
							var a = args.copy();
							if (a.length >= 3) {
								@:ast(switch (a[2].def) {
	case EKeywordList(pairs):
		var listExpr = makeAST(EKeywordList(pairs));
		var filterFn = makeAST(EFn([{ args : [PTuple([PWildcard, PVar("v")])], body : makeAST(EBinary(NotEqual, makeAST(EVar("v")), makeAST(ENil))) }]));
		var filtered = makeAST(ERemoteCall(makeAST(EVar("Enum")), "filter", [listExpr, filterFn]));
		a[2] = filtered;
		makeASTWithMeta(ERemoteCall(mod, fn, a), n.metadata, n.pos);	
	default:
		n;	
}) {
									var ` = a[2].def;
									if (enumIndex ` == 20) {
										var ` = `[0];
										{
											var pairs = `;
											{
												var listExpr = {
													var pos = null;
													{def : reflaxe.elixir.ast.ElixirASTDef.EKeywordList(pairs), metadata : {}, pos : pos};
												};
												var filterFn = {
													var pos = null;
													{def : reflaxe.elixir.ast.ElixirASTDef.EFn([{args : [reflaxe.elixir.ast.EPattern.PTuple([reflaxe.elixir.ast.EPattern.PWildcard, reflaxe.elixir.ast.EPattern.PVar("v")])], body : {
														var pos = null;
														{def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.NotEqual, {
															var pos = null;
															{def : reflaxe.elixir.ast.ElixirASTDef.EVar("v"), metadata : {}, pos : pos};
														}, {
															var pos = null;
															{def : reflaxe.elixir.ast.ElixirASTDef.ENil, metadata : {}, pos : pos};
														}), metadata : {}, pos : pos};
													}}]), metadata : {}, pos : pos};
												};
												var filtered = {
													var pos = null;
													{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
														var pos = null;
														{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Enum"), metadata : {}, pos : pos};
													}, "filter", [listExpr, filterFn]), metadata : {}, pos : pos};
												};
												a[2] = filtered;
												{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall(mod, fn, a), metadata : n.metadata, pos : n.pos};
											};
										};
									} else {
										n;
									};
								};
							} else {
								n;
							};
						} else {
							n;
						};
					};
				} else {
					n;
				};
			};
		});
	}

	static inline function isChangesetValidateLength(mod:reflaxe.elixir.ast.ElixirAST, fn:String, args:Array<reflaxe.elixir.ast.ElixirAST>) {
		if (fn != "validate_length") {
			return false;
		};
		return @:ast(switch (mod.def) {
	case EVar(name):
		name != null && (name == "Ecto.Changeset" || name.indexOf("Ecto.Changeset") != -1);	
	default:
		false;	
}) {
			var ` = mod.def;
			if (enumIndex ` == 38) {
				var ` = `[0];
				{
					var name = `;
					{
						name != null && (name == "Ecto.Changeset" || name.indexOf("Ecto.Changeset", null) != -1);
					};
				};
			} else {
				false;
			};
		};
	}
}