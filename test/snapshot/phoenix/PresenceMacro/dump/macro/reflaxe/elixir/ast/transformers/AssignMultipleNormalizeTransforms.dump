class reflaxe.elixir.ast.transformers.AssignMultipleNormalizeTransforms {

	public static function pass(ast:reflaxe.elixir.ast.ElixirAST) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(ast, function(n:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (n.def) {
	case EDef(name, args, guards, body):
		makeASTWithMeta(EDef(name, args, guards, rewrite(body)), n.metadata, n.pos);	
	case EDefp(name2, args2, guards2, body2):
		makeASTWithMeta(EDefp(name2, args2, guards2, rewrite(body2)), n.metadata, n.pos);	
	default:
		n;	
}) {
				var ` = n.def;
				switch (enumIndex `) {
					case 2: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						var ` = `[3];
						{
							var name = `;
							var args = `;
							var guards = `;
							var body = `;
							{
								{
									var def = reflaxe.elixir.ast.ElixirASTDef.EDef(name, args, guards, reflaxe.elixir.ast.transformers.AssignMultipleNormalizeTransforms.rewrite(body));
									var meta = n.metadata;
									var pos = n.pos;
									{def : def, metadata : meta, pos : pos};
								};
							};
						};
					};
					case 3: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						var ` = `[3];
						{
							var name2 = `;
							var args2 = `;
							var guards2 = `;
							var body2 = `;
							{
								{
									var def = reflaxe.elixir.ast.ElixirASTDef.EDefp(name2, args2, guards2, reflaxe.elixir.ast.transformers.AssignMultipleNormalizeTransforms.rewrite(body2));
									var meta = n.metadata;
									var pos = n.pos;
									{def : def, metadata : meta, pos : pos};
								};
							};
						};
					};
					default: {
						n;
					}
				};
			};
		});
	}

	static function rewrite(body:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (body.def) {
	case EBlock(stmts):
		var out:Array<ElixirAST> = [];
		var i = 0;
		while (i < stmts.length) {
			var cur = stmts[i];
			if (i + 1 < stmts.length) {
				var nxt = stmts[i + 1];
				var leftVar:Null<ElixirAST> = null;
				var assignsVarName:Null<String> = null;
				var mapNode:Null<ElixirAST> = null;
				switch (cur.def) {
					case EBinary(Match, l, { def : EBinary(Match, { def : EVar(av) }, m) }):
						leftVar = l;
						assignsVarName = av;
						mapNode = m;					
					default:
				};
				if (leftVar != null && assignsVarName != null && mapNode != null) {
					switch (nxt.def) {
						case ERemoteCall({ def : EVar(mod) }, "assign", [firstArg, secArg]) if (mod == "Phoenix.Component"):
							switch (secArg.def) {
								case EVar(v) if (v == assignsVarName):
									var call = makeAST(ERemoteCall(makeAST(EVar("Phoenix.Component")), "assign", [firstArg, mapNode]));
									out.push(makeAST(EBinary(Match, leftVar, call)));
									i += 2;
									continue;								
								default:
							};						
						default:
					};
				};
			};
			out.push(cur);
			i++;
		};
		makeAST(EBlock(out));	
	default:
		body;	
}) {
			var ` = body.def;
			if (enumIndex ` == 53) {
				var ` = `[0];
				{
					var stmts = `;
					{
						var out = [];
						var i = 0;
						while (i < stmts.length) {
							var cur = stmts[i];
							if (i + 1 < stmts.length) {
								var nxt = stmts[i + 1];
								var leftVar = null;
								var assignsVarName = null;
								var mapNode = null;
								@:ast(switch (cur.def) {
	case EBinary(Match, l, { def : EBinary(Match, { def : EVar(av) }, m) }):
		leftVar = l;
		assignsVarName = av;
		mapNode = m;	
	default:
}) {
									var ` = cur.def;
									if (enumIndex ` == 26) {
										var ` = `[0];
										var ` = `[1];
										var ` = `[2];
										if (enumIndex ` == 27) {
											{
												var ` = `.def;
												var ` = `.metadata;
												var ` = `.pos;
												if (enumIndex ` == 26) {
													var ` = `[0];
													var ` = `[1];
													var ` = `[2];
													if (enumIndex ` == 27) {
														{
															var ` = `.def;
															var ` = `.metadata;
															var ` = `.pos;
															if (enumIndex ` == 38) {
																var ` = `[0];
																{
																	var av = `;
																	var m = `;
																	var l = `;
																	{
																		leftVar = l;
																		assignsVarName = av;
																		mapNode = m;
																	};
																};
															} else {};
														};
													} else {};
												} else {};
											};
										} else {};
									} else {};
								};
								if (leftVar != null && assignsVarName != null && mapNode != null) {
									@:ast(switch (nxt.def) {
	case ERemoteCall({ def : EVar(mod) }, "assign", [firstArg, secArg]) if (mod == "Phoenix.Component"):
		switch (secArg.def) {
			case EVar(v) if (v == assignsVarName):
				var call = makeAST(ERemoteCall(makeAST(EVar("Phoenix.Component")), "assign", [firstArg, mapNode]));
				out.push(makeAST(EBinary(Match, leftVar, call)));
				i += 2;
				continue;			
			default:
		};	
	default:
}) {
										var ` = nxt.def;
										if (enumIndex ` == 24) {
											var ` = `[0];
											var ` = `[1];
											var ` = `[2];
											{
												var ` = `.def;
												var ` = `.metadata;
												var ` = `.pos;
												if (enumIndex ` == 38) {
													var ` = `[0];
													if (` == "assign") {
														if (`.length == 2) {
															var ` = `[0];
															var ` = `[1];
															{
																var firstArg = `;
																var secArg = `;
																var mod = `;
																if (mod == "Phoenix.Component") {
																	@:ast(switch (secArg.def) {
	case EVar(v) if (v == assignsVarName):
		var call = makeAST(ERemoteCall(makeAST(EVar("Phoenix.Component")), "assign", [firstArg, mapNode]));
		out.push(makeAST(EBinary(Match, leftVar, call)));
		i += 2;
		continue;	
	default:
}) {
																		var ` = secArg.def;
																		if (enumIndex ` == 38) {
																			var ` = `[0];
																			{
																				var v = `;
																				if (v == assignsVarName) {
																					var call = {
																						var pos = null;
																						{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
																							var pos = null;
																							{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Phoenix.Component"), metadata : {}, pos : pos};
																						}, "assign", [firstArg, mapNode]), metadata : {}, pos : pos};
																					};
																					out.push({
																						var pos = null;
																						{def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, leftVar, call), metadata : {}, pos : pos};
																					});
																					i += 2;
																					continue;
																				} else {};
																			};
																		} else {};
																	};
																} else {};
															};
														} else {};
													} else {};
												} else {};
											};
										} else {};
									};
								};
							};
							out.push(cur);
							i ++;
						};
						{
							var pos = null;
							{def : reflaxe.elixir.ast.ElixirASTDef.EBlock(out), metadata : {}, pos : pos};
						};
					};
				};
			} else {
				body;
			};
		};
	}
}