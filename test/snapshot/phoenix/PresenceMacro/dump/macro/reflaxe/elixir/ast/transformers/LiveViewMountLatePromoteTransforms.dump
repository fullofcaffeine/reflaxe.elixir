class reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms {

	public static function pass(ast:reflaxe.elixir.ast.ElixirAST) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(ast, function(n:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (n.def) {
	case EDef(name, params, guards, body) if (name == "mount" && params != null && params.length >= 3):
		promoteAt(n, false);	
	case EDefp(name, params, guards, body) if (name == "mount" && params != null && params.length >= 3):
		promoteAt(n, true);	
	default:
		n;	
}) {
				var ` = n.def;
				switch (enumIndex `) {
					case 2: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						var ` = `[3];
						{
							var name = `;
							var params = `;
							var guards = `;
							var body = `;
							if (name == "mount" && params != null && params.length >= 3) {
								reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.promoteAt(n, false);
							} else {
								n;
							};
						};
					};
					case 3: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						var ` = `[3];
						{
							var name = `;
							var params = `;
							var guards = `;
							var body = `;
							if (name == "mount" && params != null && params.length >= 3) {
								reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.promoteAt(n, true);
							} else {
								n;
							};
						};
					};
					default: {
						n;
					}
				};
			};
		});
	}

	static function promoteAt(n:reflaxe.elixir.ast.ElixirAST, isPrivate:Bool) {
		var params = @:ast(switch (n.def) {
	case EDef(_, ps, _, _):
		ps;	
	case EDefp(_, ps, _, _):
		ps;	
	default:
		null;	
}) {
			var ` = n.def;
			switch (enumIndex `) {
				case 2: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					var ` = `[3];
					{
						var ps = `;
						{
							ps;
						};
					};
				};
				case 3: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					var ` = `[3];
					{
						var ps = `;
						{
							ps;
						};
					};
				};
				default: {
					null;
				}
			};
		};
		if (params == null || params.length < 3) {
			return n;
		};
		var third = params[2];
		@:ast(switch (third) {
	case PVar(pname) if (pname != null && pname != "socket"):
		var newParams = params.copy();
		newParams[2] = PVar("socket");
		var newBody = renameVarInBody(getBody(n), pname, "socket");
		return makeASTWithMeta(isPrivate ? EDefp("mount", newParams, getGuards(n), newBody) : EDef("mount", newParams, getGuards(n), newBody), n.metadata, n.pos);	
	case PVar(pname2) if (pname2 == "socket"):
		var fixedBody = renameVarInBody(getBody(n), "_socket", "socket");
		return makeASTWithMeta(isPrivate ? EDefp("mount", params, getGuards(n), fixedBody) : EDef("mount", params, getGuards(n), fixedBody), n.metadata, n.pos);	
	default:
		return n;	
}) if (enumIndex third == 0) {
			var ` = third[0];
			{
				var pname = `;
				if (pname != null && pname != "socket") {
					var newParams = params.copy();
					newParams[2] = reflaxe.elixir.ast.EPattern.PVar("socket");
					var newBody = reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.renameVarInBody(reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.getBody(n), pname, "socket");
					return {
						var def = if ((isPrivate)) reflaxe.elixir.ast.ElixirASTDef.EDefp("mount", newParams, reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.getGuards(n), newBody) else reflaxe.elixir.ast.ElixirASTDef.EDef("mount", newParams, reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.getGuards(n), newBody);
						var meta = n.metadata;
						var pos = n.pos;
						{def : def, metadata : meta, pos : pos};
					};
				} else {
					var pname2 = `;
					if (pname2 == "socket") {
						var fixedBody = reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.renameVarInBody(reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.getBody(n), "_socket", "socket");
						return {
							var def = if ((isPrivate)) reflaxe.elixir.ast.ElixirASTDef.EDefp("mount", params, reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.getGuards(n), fixedBody) else reflaxe.elixir.ast.ElixirASTDef.EDef("mount", params, reflaxe.elixir.ast.transformers.LiveViewMountLatePromoteTransforms.getGuards(n), fixedBody);
							var meta = n.metadata;
							var pos = n.pos;
							{def : def, metadata : meta, pos : pos};
						};
					} else {
						return n;
					};
				};
			};
		} else {
			return n;
		};
	}

	static function getBody(n:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (n.def) {
	case EDef(_, _, _, b):
		b;	
	case EDefp(_, _, _, b):
		b;	
	default:
		n;	
}) {
			var ` = n.def;
			switch (enumIndex `) {
				case 2: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					var ` = `[3];
					{
						var b = `;
						{
							b;
						};
					};
				};
				case 3: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					var ` = `[3];
					{
						var b = `;
						{
							b;
						};
					};
				};
				default: {
					n;
				}
			};
		};
	}

	static function getGuards(n:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (n.def) {
	case EDef(_, _, g, _):
		g;	
	case EDefp(_, _, g, _):
		g;	
	default:
		null;	
}) {
			var ` = n.def;
			switch (enumIndex `) {
				case 2: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					var ` = `[3];
					{
						var g = `;
						{
							g;
						};
					};
				};
				case 3: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					var ` = `[3];
					{
						var g = `;
						{
							g;
						};
					};
				};
				default: {
					null;
				}
			};
		};
	}

	static function renameVarInBody(body:reflaxe.elixir.ast.ElixirAST, from:String, to:String) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(body, function(x:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (x.def) {
	case EVar(v) if (v == from):
		makeASTWithMeta(EVar(to), x.metadata, x.pos);	
	default:
		x;	
}) {
				var ` = x.def;
				if (enumIndex ` == 38) {
					var ` = `[0];
					{
						var v = `;
						if (v == from) {
							{def : reflaxe.elixir.ast.ElixirASTDef.EVar(to), metadata : x.metadata, pos : x.pos};
						} else {
							x;
						};
					};
				} else {
					x;
				};
			};
		});
	}
}