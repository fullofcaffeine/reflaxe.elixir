class reflaxe.elixir.ast.transformers.PresenceRouteLocalizeTransforms {

	public static function pass(ast:reflaxe.elixir.ast.ElixirAST) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(ast, function(n:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (n.def) {
	case EModule(name, attrs, body):
		if (!endsWithPresence(name)) return n;
		var reb = localize(n, name);
		reb;	
	case EDefmodule(name, doBlock):
		if (!endsWithPresence(name)) return n;
		var inner = localize(doBlock, name);
		makeASTWithMeta(EDefmodule(name, inner), n.metadata, n.pos);	
	default:
		n;	
}) {
				var ` = n.def;
				switch (enumIndex `) {
					case 0: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var name = `;
							var attrs = `;
							var body = `;
							{
								if (! reflaxe.elixir.ast.transformers.PresenceRouteLocalizeTransforms.endsWithPresence(name)) {
									return n;
								};
								var reb = reflaxe.elixir.ast.transformers.PresenceRouteLocalizeTransforms.localize(n, name);
								reb;
							};
						};
					};
					case 1: {
						var ` = `[0];
						var ` = `[1];
						{
							var name = `;
							var doBlock = `;
							{
								if (! reflaxe.elixir.ast.transformers.PresenceRouteLocalizeTransforms.endsWithPresence(name)) {
									return n;
								};
								var inner = reflaxe.elixir.ast.transformers.PresenceRouteLocalizeTransforms.localize(doBlock, name);
								{def : reflaxe.elixir.ast.ElixirASTDef.EDefmodule(name, inner), metadata : n.metadata, pos : n.pos};
							};
						};
					};
					default: {
						n;
					}
				};
			};
		});
	}

	static function endsWithPresence(name:String) {
		return name != null && (StringTools.endsWith(name, ".Presence") || name == "Presence");
	}

	static function localize(node:reflaxe.elixir.ast.ElixirAST, moduleName:String) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(node, function(x:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (x.def) {
	case ERemoteCall(mod, fn, args):
		switch (mod.def) {
			case EField({ def : EVar("Phoenix") }, "Presence"):
				makeASTWithMeta(ERemoteCall(makeAST(EVar(moduleName)), fn, args), x.metadata, x.pos);			
			case EVar(mname) if (mname == "Phoenix.Presence"):
				makeASTWithMeta(ERemoteCall(makeAST(EVar(moduleName)), fn, args), x.metadata, x.pos);			
			default:
				x;			
		};	
	case ECall(target, fn, args):
		switch (target != null ? target.def : null) {
			case EField({ def : EField({ def : EVar("Phoenix") }, "Presence") }, f) if (f == fn):
				makeASTWithMeta(ERemoteCall(makeAST(EVar(moduleName)), fn, args), x.metadata, x.pos);			
			default:
				x;			
		};	
	case EField(target, field):
		switch (target.def) {
			case EField({ def : EVar("Phoenix") }, "Presence"):
				makeASTWithMeta(EField(makeAST(EVar(moduleName)), field), x.metadata, x.pos);			
			default:
				x;			
		};	
	default:
		x;	
}) {
				var ` = x.def;
				switch (enumIndex `) {
					case 22: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var target = `;
							var fn = `;
							var args = `;
							{
								@:ast(switch (target != null ? target.def : null) {
	case EField({ def : EField({ def : EVar("Phoenix") }, "Presence") }, f) if (f == fn):
		makeASTWithMeta(ERemoteCall(makeAST(EVar(moduleName)), fn, args), x.metadata, x.pos);	
	default:
		x;	
}) {
									var ` = if (target != null) {
										target.def;
									} else {
										null;
									};
									if (` == null) {
										x;
									} else if (enumIndex ` == 28) {
										var ` = `[0];
										var ` = `[1];
										{
											var ` = `.def;
											var ` = `.metadata;
											var ` = `.pos;
											if (enumIndex ` == 28) {
												var ` = `[0];
												var ` = `[1];
												{
													var ` = `.def;
													var ` = `.metadata;
													var ` = `.pos;
													if (enumIndex ` == 38) {
														var ` = `[0];
														if (` == "Phoenix") {
															if (` == "Presence") {
																{
																	var f = `;
																	if (f == fn) {
																		{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
																			var pos = null;
																			{def : reflaxe.elixir.ast.ElixirASTDef.EVar(moduleName), metadata : {}, pos : pos};
																		}, fn, args), metadata : x.metadata, pos : x.pos};
																	} else {
																		x;
																	};
																};
															} else {
																x;
															};
														} else {
															x;
														};
													} else {
														x;
													};
												};
											} else {
												x;
											};
										};
									} else {
										x;
									};
								};
							};
						};
					};
					case 24: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var mod = `;
							var fn = `;
							var args = `;
							{
								@:ast(switch (mod.def) {
	case EField({ def : EVar("Phoenix") }, "Presence"):
		makeASTWithMeta(ERemoteCall(makeAST(EVar(moduleName)), fn, args), x.metadata, x.pos);	
	case EVar(mname) if (mname == "Phoenix.Presence"):
		makeASTWithMeta(ERemoteCall(makeAST(EVar(moduleName)), fn, args), x.metadata, x.pos);	
	default:
		x;	
}) {
									var ` = mod.def;
									switch (enumIndex `) {
										case 28: {
											var ` = `[0];
											var ` = `[1];
											{
												var ` = `.def;
												var ` = `.metadata;
												var ` = `.pos;
												if (enumIndex ` == 38) {
													var ` = `[0];
													if (` == "Phoenix") {
														if (` == "Presence") {
															{
																{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
																	var pos = null;
																	{def : reflaxe.elixir.ast.ElixirASTDef.EVar(moduleName), metadata : {}, pos : pos};
																}, fn, args), metadata : x.metadata, pos : x.pos};
															};
														} else {
															x;
														};
													} else {
														x;
													};
												} else {
													x;
												};
											};
										};
										case 38: {
											var ` = `[0];
											{
												var mname = `;
												if (mname == "Phoenix.Presence") {
													{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
														var pos = null;
														{def : reflaxe.elixir.ast.ElixirASTDef.EVar(moduleName), metadata : {}, pos : pos};
													}, fn, args), metadata : x.metadata, pos : x.pos};
												} else {
													x;
												};
											};
										};
										default: {
											x;
										}
									};
								};
							};
						};
					};
					case 28: {
						var ` = `[0];
						var ` = `[1];
						{
							var target = `;
							var field = `;
							{
								@:ast(switch (target.def) {
	case EField({ def : EVar("Phoenix") }, "Presence"):
		makeASTWithMeta(EField(makeAST(EVar(moduleName)), field), x.metadata, x.pos);	
	default:
		x;	
}) {
									var ` = target.def;
									if (enumIndex ` == 28) {
										var ` = `[0];
										var ` = `[1];
										{
											var ` = `.def;
											var ` = `.metadata;
											var ` = `.pos;
											if (enumIndex ` == 38) {
												var ` = `[0];
												if (` == "Phoenix") {
													if (` == "Presence") {
														{
															{def : reflaxe.elixir.ast.ElixirASTDef.EField({
																var pos = null;
																{def : reflaxe.elixir.ast.ElixirASTDef.EVar(moduleName), metadata : {}, pos : pos};
															}, field), metadata : x.metadata, pos : x.pos};
														};
													} else {
														x;
													};
												} else {
													x;
												};
											} else {
												x;
											};
										};
									} else {
										x;
									};
								};
							};
						};
					};
					default: {
						x;
					}
				};
			};
		});
	}
}