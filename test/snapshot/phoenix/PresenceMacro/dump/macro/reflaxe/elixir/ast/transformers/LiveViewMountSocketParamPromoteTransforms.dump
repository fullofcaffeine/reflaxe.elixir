class reflaxe.elixir.ast.transformers.LiveViewMountSocketParamPromoteTransforms {

	public static function promotePass(ast:reflaxe.elixir.ast.ElixirAST) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(ast, function(n:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (n.def) {
	case EDef(name, params, guards, body) if (name == "mount" && params != null && params.length >= 3):
		var third = params[2];
		switch (third) {
			case PVar(pname) if (pname != null && pname != "socket"):
				var newParams = params.copy();
				newParams[2] = PVar("socket");
				var newBody = renameVarInBody(body, pname, "socket");
				makeASTWithMeta(EDef(name, newParams, guards, newBody), n.metadata, n.pos);			
			default:
				n;			
		};	
	case EDefp(privateName, privateParams, privateGuards, privateBody) if (privateName == "mount" && privateParams != null && privateParams.length >= 3):
		var thirdParam = privateParams[2];
		switch (thirdParam) {
			case PVar(paramName) if (paramName != null && paramName != "socket"):
				var updatedParams = privateParams.copy();
				updatedParams[2] = PVar("socket");
				var updatedBody = renameVarInBody(privateBody, paramName, "socket");
				makeASTWithMeta(EDefp(privateName, updatedParams, privateGuards, updatedBody), n.metadata, n.pos);			
			default:
				n;			
		};	
	default:
		n;	
}) {
				var ` = n.def;
				switch (enumIndex `) {
					case 2: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						var ` = `[3];
						{
							var name = `;
							var params = `;
							var guards = `;
							var body = `;
							if (name == "mount" && params != null && params.length >= 3) {
								var third = params[2];
								@:ast(switch (third) {
	case PVar(pname) if (pname != null && pname != "socket"):
		var newParams = params.copy();
		newParams[2] = PVar("socket");
		var newBody = renameVarInBody(body, pname, "socket");
		makeASTWithMeta(EDef(name, newParams, guards, newBody), n.metadata, n.pos);	
	default:
		n;	
}) if (enumIndex third == 0) {
									var ` = third[0];
									{
										var pname = `;
										if (pname != null && pname != "socket") {
											var newParams = params.copy();
											newParams[2] = reflaxe.elixir.ast.EPattern.PVar("socket");
											var newBody = reflaxe.elixir.ast.transformers.LiveViewMountSocketParamPromoteTransforms.renameVarInBody(body, pname, "socket");
											{def : reflaxe.elixir.ast.ElixirASTDef.EDef(name, newParams, guards, newBody), metadata : n.metadata, pos : n.pos};
										} else {
											n;
										};
									};
								} else {
									n;
								};
							} else {
								n;
							};
						};
					};
					case 3: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						var ` = `[3];
						{
							var privateName = `;
							var privateParams = `;
							var privateGuards = `;
							var privateBody = `;
							if (privateName == "mount" && privateParams != null && privateParams.length >= 3) {
								var thirdParam = privateParams[2];
								@:ast(switch (thirdParam) {
	case PVar(paramName) if (paramName != null && paramName != "socket"):
		var updatedParams = privateParams.copy();
		updatedParams[2] = PVar("socket");
		var updatedBody = renameVarInBody(privateBody, paramName, "socket");
		makeASTWithMeta(EDefp(privateName, updatedParams, privateGuards, updatedBody), n.metadata, n.pos);	
	default:
		n;	
}) if (enumIndex thirdParam == 0) {
									var ` = thirdParam[0];
									{
										var paramName = `;
										if (paramName != null && paramName != "socket") {
											var updatedParams = privateParams.copy();
											updatedParams[2] = reflaxe.elixir.ast.EPattern.PVar("socket");
											var updatedBody = reflaxe.elixir.ast.transformers.LiveViewMountSocketParamPromoteTransforms.renameVarInBody(privateBody, paramName, "socket");
											{def : reflaxe.elixir.ast.ElixirASTDef.EDefp(privateName, updatedParams, privateGuards, updatedBody), metadata : n.metadata, pos : n.pos};
										} else {
											n;
										};
									};
								} else {
									n;
								};
							} else {
								n;
							};
						};
					};
					default: {
						n;
					}
				};
			};
		});
	}

	static function renameVarInBody(body:reflaxe.elixir.ast.ElixirAST, from:String, to:String) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(body, function(x:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (x.def) {
	case EVar(v) if (v == from):
		makeASTWithMeta(EVar(to), x.metadata, x.pos);	
	default:
		x;	
}) {
				var ` = x.def;
				if (enumIndex ` == 38) {
					var ` = `[0];
					{
						var v = `;
						if (v == from) {
							{def : reflaxe.elixir.ast.ElixirASTDef.EVar(to), metadata : x.metadata, pos : x.pos};
						} else {
							x;
						};
					};
				} else {
					x;
				};
			};
		});
	}
}