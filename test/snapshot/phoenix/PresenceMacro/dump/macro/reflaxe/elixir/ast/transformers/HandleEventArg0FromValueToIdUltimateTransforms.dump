class reflaxe.elixir.ast.transformers.HandleEventArg0FromValueToIdUltimateTransforms {

	public static function pass(ast:reflaxe.elixir.ast.ElixirAST) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(ast, function(n:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (n.def) {
	case EDef(name, args, guards, body) if (isHandleEvent3(name, args)):
		var ev:Null<String> = switch (args[0]) {
			case PLiteral({ def : EString(s) }):
				s.toLowerCase();			
			default:
				null;			
		};
		if (!isIdBasedEvent(ev)) return n;
		var paramsVar = secondArg(args);
		var socketVar = thirdArg(args);
		var nb = rewrite(body, paramsVar, socketVar);
		makeASTWithMeta(EDef(name, args, guards, nb), n.metadata, n.pos);	
	case EDefp(name2, args2, guards2, body2) if (isHandleEvent3(name2, args2)):
		var ev2:Null<String> = switch (args2[0]) {
			case PLiteral({ def : EString(s2) }):
				s2.toLowerCase();			
			default:
				null;			
		};
		if (!isIdBasedEvent(ev2)) return n;
		var paramsVar2 = secondArg(args2);
		var socketVar2 = thirdArg(args2);
		var nb2 = rewrite(body2, paramsVar2, socketVar2);
		makeASTWithMeta(EDefp(name2, args2, guards2, nb2), n.metadata, n.pos);	
	default:
		n;	
}) {
				var ` = n.def;
				switch (enumIndex `) {
					case 2: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						var ` = `[3];
						{
							var name = `;
							var args = `;
							var guards = `;
							var body = `;
							if (name == "handle_event" && args != null && args.length == 3 && @:ast(switch (args[0]) {
	case PLiteral({ def : EString(_) }):
		true;	
	default:
		false;	
}) {
								var ` = args[0];
								if (enumIndex ` == 1) {
									var ` = `[0];
									{
										var ` = `.def;
										var ` = `.metadata;
										var ` = `.pos;
										if (enumIndex ` == 32) {
											var ` = `[0];
											{
												true;
											};
										} else {
											false;
										};
									};
								} else {
									false;
								};
							}) {
								var ev = @:ast(switch (args[0]) {
	case PLiteral({ def : EString(s) }):
		s.toLowerCase();	
	default:
		null;	
}) {
									var ` = args[0];
									if (enumIndex ` == 1) {
										var ` = `[0];
										{
											var ` = `.def;
											var ` = `.metadata;
											var ` = `.pos;
											if (enumIndex ` == 32) {
												var ` = `[0];
												{
													var s = `;
													{
														s.toLowerCase();
													};
												};
											} else {
												null;
											};
										};
									} else {
										null;
									};
								};
								if (! if (ev == null) {
									false;
								} else {
									ev == "toggle_todo" || ev == "delete_todo" || ev == "edit_todo";
								}) {
									return n;
								};
								var paramsVar = @:ast(switch (args[1]) {
	case PVar(n):
		n;	
	default:
		"params";	
}) {
									var ` = args[1];
									if (enumIndex ` == 0) {
										var ` = `[0];
										{
											var n = `;
											{
												n;
											};
										};
									} else {
										"params";
									};
								};
								var socketVar = @:ast(switch (args[2]) {
	case PVar(n):
		n;	
	default:
		"socket";	
}) {
									var ` = args[2];
									if (enumIndex ` == 0) {
										var ` = `[0];
										{
											var n = `;
											{
												n;
											};
										};
									} else {
										"socket";
									};
								};
								var nb = reflaxe.elixir.ast.transformers.HandleEventArg0FromValueToIdUltimateTransforms.rewrite(body, paramsVar, socketVar);
								{def : reflaxe.elixir.ast.ElixirASTDef.EDef(name, args, guards, nb), metadata : n.metadata, pos : n.pos};
							} else {
								n;
							};
						};
					};
					case 3: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						var ` = `[3];
						{
							var name2 = `;
							var args2 = `;
							var guards2 = `;
							var body2 = `;
							if (name2 == "handle_event" && args2 != null && args2.length == 3 && @:ast(switch (args[0]) {
	case PLiteral({ def : EString(_) }):
		true;	
	default:
		false;	
}) {
								var ` = args2[0];
								if (enumIndex ` == 1) {
									var ` = `[0];
									{
										var ` = `.def;
										var ` = `.metadata;
										var ` = `.pos;
										if (enumIndex ` == 32) {
											var ` = `[0];
											{
												true;
											};
										} else {
											false;
										};
									};
								} else {
									false;
								};
							}) {
								var ev2 = @:ast(switch (args2[0]) {
	case PLiteral({ def : EString(s2) }):
		s2.toLowerCase();	
	default:
		null;	
}) {
									var ` = args2[0];
									if (enumIndex ` == 1) {
										var ` = `[0];
										{
											var ` = `.def;
											var ` = `.metadata;
											var ` = `.pos;
											if (enumIndex ` == 32) {
												var ` = `[0];
												{
													var s2 = `;
													{
														s2.toLowerCase();
													};
												};
											} else {
												null;
											};
										};
									} else {
										null;
									};
								};
								if (! if (ev2 == null) {
									false;
								} else {
									ev2 == "toggle_todo" || ev2 == "delete_todo" || ev2 == "edit_todo";
								}) {
									return n;
								};
								var paramsVar2 = @:ast(switch (args[1]) {
	case PVar(n):
		n;	
	default:
		"params";	
}) {
									var ` = args2[1];
									if (enumIndex ` == 0) {
										var ` = `[0];
										{
											var n = `;
											{
												n;
											};
										};
									} else {
										"params";
									};
								};
								var socketVar2 = @:ast(switch (args[2]) {
	case PVar(n):
		n;	
	default:
		"socket";	
}) {
									var ` = args2[2];
									if (enumIndex ` == 0) {
										var ` = `[0];
										{
											var n = `;
											{
												n;
											};
										};
									} else {
										"socket";
									};
								};
								var nb2 = reflaxe.elixir.ast.transformers.HandleEventArg0FromValueToIdUltimateTransforms.rewrite(body2, paramsVar2, socketVar2);
								{def : reflaxe.elixir.ast.ElixirASTDef.EDefp(name2, args2, guards2, nb2), metadata : n.metadata, pos : n.pos};
							} else {
								n;
							};
						};
					};
					default: {
						n;
					}
				};
			};
		});
	}

	static inline function isHandleEvent3(name:String, args:Array<reflaxe.elixir.ast.EPattern>) {
		return name == "handle_event" && args != null && args.length == 3 && @:ast(switch (args[0]) {
	case PLiteral({ def : EString(_) }):
		true;	
	default:
		false;	
}) {
			var ` = args[0];
			if (enumIndex ` == 1) {
				var ` = `[0];
				{
					var ` = `.def;
					var ` = `.metadata;
					var ` = `.pos;
					if (enumIndex ` == 32) {
						var ` = `[0];
						{
							true;
						};
					} else {
						false;
					};
				};
			} else {
				false;
			};
		};
	}

	static inline function isIdBasedEvent(ev:Null<String>) {
		if (ev == null) {
			return false;
		};
		return ev == "toggle_todo" || ev == "delete_todo" || ev == "edit_todo";
	}

	static inline function secondArg(args:Array<reflaxe.elixir.ast.EPattern>) {
		return @:ast(switch (args[1]) {
	case PVar(n):
		n;	
	default:
		"params";	
}) {
			var ` = args[1];
			if (enumIndex ` == 0) {
				var ` = `[0];
				{
					var n = `;
					{
						n;
					};
				};
			} else {
				"params";
			};
		};
	}

	static inline function thirdArg(args:Array<reflaxe.elixir.ast.EPattern>) {
		return @:ast(switch (args[2]) {
	case PVar(n):
		n;	
	default:
		"socket";	
}) {
			var ` = args[2];
			if (enumIndex ` == 0) {
				var ` = `[0];
				{
					var n = `;
					{
						n;
					};
				};
			} else {
				"socket";
			};
		};
	}

	static function rewrite(body:reflaxe.elixir.ast.ElixirAST, paramsVar:String, socketVar:String) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(body, function(x:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (x.def) {
	case ECall(target, fname, args) if (args != null && args.length >= 2):
		if (!lastArgIsSocket(args, socketVar)) return x;
		var first = args[0];
		var replace = extractIdFromValueOrNull(first, paramsVar);
		if (replace == null) return x;
		var newArgs = args.copy();
		newArgs[0] = replace;
		makeASTWithMeta(ECall(target, fname, newArgs), x.metadata, x.pos);	
	case ERemoteCall(target2, fname2, args2) if (args2 != null && args2.length >= 2):
		if (!lastArgIsSocket(args2, socketVar)) return x;
		var first2 = args2[0];
		var replace2 = extractIdFromValueOrNull(first2, paramsVar);
		if (replace2 == null) return x;
		var newArgs2 = args2.copy();
		newArgs2[0] = replace2;
		makeASTWithMeta(ERemoteCall(target2, fname2, newArgs2), x.metadata, x.pos);	
	default:
		x;	
}) {
				var ` = x.def;
				switch (enumIndex `) {
					case 22: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var target = `;
							var fname = `;
							var args = `;
							if (args != null && args.length >= 2) {
								if (! args.length >= 1 && @:ast(switch (args[args.length - 1].def) {
	case EVar(v) if (v == socketVar):
		true;	
	default:
		false;	
}) {
									var ` = args[args.length - 1].def;
									if (enumIndex ` == 38) {
										var ` = `[0];
										{
											var v = `;
											if (v == socketVar) {
												true;
											} else {
												false;
											};
										};
									} else {
										false;
									};
								}) {
									return x;
								};
								var first = args[0];
								var replace = reflaxe.elixir.ast.transformers.HandleEventArg0FromValueToIdUltimateTransforms.extractIdFromValueOrNull(first, paramsVar);
								if (replace == null) {
									return x;
								};
								var newArgs = args.copy();
								newArgs[0] = replace;
								{def : reflaxe.elixir.ast.ElixirASTDef.ECall(target, fname, newArgs), metadata : x.metadata, pos : x.pos};
							} else {
								x;
							};
						};
					};
					case 24: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var target2 = `;
							var fname2 = `;
							var args2 = `;
							if (args2 != null && args2.length >= 2) {
								if (! args2.length >= 1 && @:ast(switch (args[args.length - 1].def) {
	case EVar(v) if (v == socketVar):
		true;	
	default:
		false;	
}) {
									var ` = args2[args2.length - 1].def;
									if (enumIndex ` == 38) {
										var ` = `[0];
										{
											var v = `;
											if (v == socketVar) {
												true;
											} else {
												false;
											};
										};
									} else {
										false;
									};
								}) {
									return x;
								};
								var first2 = args2[0];
								var replace2 = reflaxe.elixir.ast.transformers.HandleEventArg0FromValueToIdUltimateTransforms.extractIdFromValueOrNull(first2, paramsVar);
								if (replace2 == null) {
									return x;
								};
								var newArgs2 = args2.copy();
								newArgs2[0] = replace2;
								{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall(target2, fname2, newArgs2), metadata : x.metadata, pos : x.pos};
							} else {
								x;
							};
						};
					};
					default: {
						x;
					}
				};
			};
		});
	}

	static inline function lastArgIsSocket(args:Array<reflaxe.elixir.ast.ElixirAST>, socketVar:String) {
		return args.length >= 1 && @:ast(switch (args[args.length - 1].def) {
	case EVar(v) if (v == socketVar):
		true;	
	default:
		false;	
}) {
			var ` = args[args.length - 1].def;
			if (enumIndex ` == 38) {
				var ` = `[0];
				{
					var v = `;
					if (v == socketVar) {
						true;
					} else {
						false;
					};
				};
			} else {
				false;
			};
		};
	}

	static function extractIdFromValueOrNull(node:reflaxe.elixir.ast.ElixirAST, paramsVar:String) {
		@:ast(switch (node.def) {
	case ERemoteCall({ def : EVar("Map") }, "get", a) if (a != null && a.length >= 2):
		if (isParamsVar(a[0], paramsVar) && isValueKey(a[1])) return buildIdFromNested(paramsVar);	
	case ECall(tgt, "get", a2):
		var isMap = switch (tgt.def) {
			case EVar(m):
				m == "Map";			
			default:
				false;			
		};
		if (isMap && a2 != null && a2.length >= 2) {
			if (isParamsVar(a2[0], paramsVar) && isValueKey(a2[1])) return buildIdFromNested(paramsVar);
		};	
	default:
}) {
			var ` = node.def;
			switch (enumIndex `) {
				case 22: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					if (` == "get") {
						{
							var tgt = `;
							var a2 = `;
							{
								var isMap = @:ast(switch (tgt.def) {
	case EVar(m):
		m == "Map";	
	default:
		false;	
}) {
									var ` = tgt.def;
									if (enumIndex ` == 38) {
										var ` = `[0];
										{
											var m = `;
											{
												m == "Map";
											};
										};
									} else {
										false;
									};
								};
								if (isMap && a2 != null && a2.length >= 2) {
									if (@:ast(switch (ast.def) {
	case EVar(v) if (v == paramsVar):
		true;	
	default:
		false;	
}) {
										var ` = a2[0].def;
										if (enumIndex ` == 38) {
											var ` = `[0];
											{
												var v = `;
												if (v == paramsVar) {
													true;
												} else {
													false;
												};
											};
										} else {
											false;
										};
									} && @:ast(switch (ast.def) {
	case EString(s):
		s == "value";	
	default:
		false;	
}) {
										var ` = a2[1].def;
										if (enumIndex ` == 32) {
											var ` = `[0];
											{
												var s = `;
												{
													s == "value";
												};
											};
										} else {
											false;
										};
									}) {
										return reflaxe.elixir.ast.transformers.HandleEventArg0FromValueToIdUltimateTransforms.buildIdFromNested(paramsVar);
									};
								};
							};
						};
					} else {};
				};
				case 24: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					{
						var ` = `.def;
						var ` = `.metadata;
						var ` = `.pos;
						if (enumIndex ` == 38) {
							var ` = `[0];
							if (` == "Map") {
								if (` == "get") {
									{
										var a = `;
										if (a != null && a.length >= 2) {
											if (@:ast(switch (ast.def) {
	case EVar(v) if (v == paramsVar):
		true;	
	default:
		false;	
}) {
												var ` = a[0].def;
												if (enumIndex ` == 38) {
													var ` = `[0];
													{
														var v = `;
														if (v == paramsVar) {
															true;
														} else {
															false;
														};
													};
												} else {
													false;
												};
											} && @:ast(switch (ast.def) {
	case EString(s):
		s == "value";	
	default:
		false;	
}) {
												var ` = a[1].def;
												if (enumIndex ` == 32) {
													var ` = `[0];
													{
														var s = `;
														{
															s == "value";
														};
													};
												} else {
													false;
												};
											}) {
												return reflaxe.elixir.ast.transformers.HandleEventArg0FromValueToIdUltimateTransforms.buildIdFromNested(paramsVar);
											};
										} else {};
									};
								} else {};
							} else {};
						} else {};
					};
				};
				default: {}
			};
		};
		return null;
	}

	static inline function isParamsVar(ast:reflaxe.elixir.ast.ElixirAST, paramsVar:String) {
		return @:ast(switch (ast.def) {
	case EVar(v) if (v == paramsVar):
		true;	
	default:
		false;	
}) {
			var ` = ast.def;
			if (enumIndex ` == 38) {
				var ` = `[0];
				{
					var v = `;
					if (v == paramsVar) {
						true;
					} else {
						false;
					};
				};
			} else {
				false;
			};
		};
	}

	static inline function isValueKey(ast:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (ast.def) {
	case EString(s):
		s == "value";	
	default:
		false;	
}) {
			var ` = ast.def;
			if (enumIndex ` == 32) {
				var ` = `[0];
				{
					var s = `;
					{
						s == "value";
					};
				};
			} else {
				false;
			};
		};
	}

	static function buildIdFromNested(paramsVar:String) {
		var inner = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Map"), metadata : {}, pos : pos};
			}, "get", [{
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar(paramsVar), metadata : {}, pos : pos};
			}, {
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EString("value"), metadata : {}, pos : pos};
			}]), metadata : {}, pos : pos};
		};
		var idFromParams = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Map"), metadata : {}, pos : pos};
			}, "get", [{
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar(paramsVar), metadata : {}, pos : pos};
			}, {
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EString("id"), metadata : {}, pos : pos};
			}, {
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar(paramsVar), metadata : {}, pos : pos};
			}]), metadata : {}, pos : pos};
		};
		var isMap = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Kernel"), metadata : {}, pos : pos};
			}, "is_map", [inner]), metadata : {}, pos : pos};
		};
		var idFromInner = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Map"), metadata : {}, pos : pos};
			}, "get", [inner, {
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EString("id"), metadata : {}, pos : pos};
			}, idFromParams]), metadata : {}, pos : pos};
		};
		var isBin = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Kernel"), metadata : {}, pos : pos};
			}, "is_binary", [inner]), metadata : {}, pos : pos};
		};
		var decoded = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("URI"), metadata : {}, pos : pos};
			}, "decode_query", [inner]), metadata : {}, pos : pos};
		};
		var idFromDecoded = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Map"), metadata : {}, pos : pos};
			}, "get", [decoded, {
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EString("id"), metadata : {}, pos : pos};
			}, idFromParams]), metadata : {}, pos : pos};
		};
		var elseBranch = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.EIf(isBin, idFromDecoded, idFromParams), metadata : {}, pos : pos};
		};
		var idRaw = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.EIf(isMap, idFromInner, elseBranch), metadata : {}, pos : pos};
		};
		var isBinId = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("Kernel"), metadata : {}, pos : pos};
			}, "is_binary", [idRaw]), metadata : {}, pos : pos};
		};
		var toInt = {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
				var pos = null;
				{def : reflaxe.elixir.ast.ElixirASTDef.EVar("String"), metadata : {}, pos : pos};
			}, "to_integer", [idRaw]), metadata : {}, pos : pos};
		};
		return {
			var pos = null;
			{def : reflaxe.elixir.ast.ElixirASTDef.EIf(isBinId, toInt, idRaw), metadata : {}, pos : pos};
		};
	}
}