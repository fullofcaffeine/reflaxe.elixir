class reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms {

	public static function transformPass(ast:reflaxe.elixir.ast.ElixirAST) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(ast, function(n:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (n.def) {
	case EBinary(Match, left0, rhs0):
		var forceQuery:Bool = false;
		var isDown = switch (rhs0.def) {
			case ERemoteCall({ def : EVar(m0) }, "downcase", args0) if (m0 == "String" && args0 != null && args0.length == 1):
				switch (args0[0].def) {
					case EVar(v0) if (v0 == "search_query"):
						true;					
					default:
						false;					
				};			
			default:
				false;			
		};
		if (isDown) {
			switch (left0.def) {
				case EVar(nm) if (nm != "query"):
					forceQuery = true;				
				case EUnderscore:
					forceQuery = true;				
				default:
			};
		};
		if (forceQuery) return makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs0), n.metadata, n.pos) else n;	
	case EMatch(pat0, rhs1):
		var isDown2 = switch (rhs1.def) {
			case ERemoteCall({ def : EVar(m1) }, "downcase", args1) if (m1 == "String" && args1 != null && args1.length == 1):
				switch (args1[0].def) {
					case EVar(v1) if (v1 == "search_query"):
						true;					
					default:
						false;					
				};			
			default:
				false;			
		};
		if (isDown2) {
			switch (pat0) {
				case PVar(nm) if (nm != "query"):
					return makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs1), n.metadata, n.pos);				
				case PWildcard:
					return makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs1), n.metadata, n.pos);				
				default:
			};
		};
		n;	
	case EIf(cond, thenB, elseB) if (detectSearchGuard(cond)):
		var newThen = finalizeBranch(thenB);
		if (newThen != thenB) makeASTWithMeta(EIf(cond, newThen, elseB), n.metadata, n.pos) else n;	
	case EBlock(_):
		var nb = finalizeBranch(n);
		nb;	
	case EDo(_):
		var nb2 = finalizeBranch(n);
		nb2;	
	default:
		n;	
}) {
				var ` = n.def;
				switch (enumIndex `) {
					case 8: {
						var ` = `[0];
						var ` = `[1];
						{
							var pat0 = `;
							var rhs1 = `;
							{
								var isDown2 = @:ast(switch (rhs1.def) {
	case ERemoteCall({ def : EVar(m1) }, "downcase", args1) if (m1 == "String" && args1 != null && args1.length == 1):
		switch (args1[0].def) {
			case EVar(v1) if (v1 == "search_query"):
				true;			
			default:
				false;			
		};	
	default:
		false;	
}) {
									var ` = rhs1.def;
									if (enumIndex ` == 24) {
										var ` = `[0];
										var ` = `[1];
										var ` = `[2];
										{
											var ` = `.def;
											var ` = `.metadata;
											var ` = `.pos;
											if (enumIndex ` == 38) {
												var ` = `[0];
												if (` == "downcase") {
													{
														var m1 = `;
														var args1 = `;
														if (m1 == "String" && args1 != null && args1.length == 1) {
															@:ast(switch (args1[0].def) {
	case EVar(v1) if (v1 == "search_query"):
		true;	
	default:
		false;	
}) {
																var ` = args1[0].def;
																if (enumIndex ` == 38) {
																	var ` = `[0];
																	{
																		var v1 = `;
																		if (v1 == "search_query") {
																			true;
																		} else {
																			false;
																		};
																	};
																} else {
																	false;
																};
															};
														} else {
															false;
														};
													};
												} else {
													false;
												};
											} else {
												false;
											};
										};
									} else {
										false;
									};
								};
								if (isDown2) {
									@:ast(switch (pat0) {
	case PVar(nm) if (nm != "query"):
		return makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs1), n.metadata, n.pos);	
	case PWildcard:
		return makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs1), n.metadata, n.pos);	
	default:
}) switch (enumIndex pat0) {
										case 0: {
											var ` = pat0[0];
											{
												var nm = `;
												if (nm != "query") {
													return {def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, {
														var pos = null;
														{def : reflaxe.elixir.ast.ElixirASTDef.EVar("query"), metadata : {}, pos : pos};
													}, rhs1), metadata : n.metadata, pos : n.pos};
												} else {};
											};
										};
										case 8: {
											{
												return {def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, {
													var pos = null;
													{def : reflaxe.elixir.ast.ElixirASTDef.EVar("query"), metadata : {}, pos : pos};
												}, rhs1), metadata : n.metadata, pos : n.pos};
											};
										};
										default: {}
									};
								};
								n;
							};
						};
					};
					case 10: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var cond = `;
							var thenB = `;
							var elseB = `;
							if (reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.detectSearchGuard(cond)) {
								var newThen = reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.finalizeBranch(thenB);
								if (newThen != thenB) {
									{def : reflaxe.elixir.ast.ElixirASTDef.EIf(cond, newThen, elseB), metadata : n.metadata, pos : n.pos};
								} else {
									n;
								};
							} else {
								n;
							};
						};
					};
					case 26: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						if (enumIndex ` == 27) {
							{
								var left0 = `;
								var rhs0 = `;
								{
									var forceQuery = false;
									var isDown = @:ast(switch (rhs0.def) {
	case ERemoteCall({ def : EVar(m0) }, "downcase", args0) if (m0 == "String" && args0 != null && args0.length == 1):
		switch (args0[0].def) {
			case EVar(v0) if (v0 == "search_query"):
				true;			
			default:
				false;			
		};	
	default:
		false;	
}) {
										var ` = rhs0.def;
										if (enumIndex ` == 24) {
											var ` = `[0];
											var ` = `[1];
											var ` = `[2];
											{
												var ` = `.def;
												var ` = `.metadata;
												var ` = `.pos;
												if (enumIndex ` == 38) {
													var ` = `[0];
													if (` == "downcase") {
														{
															var m0 = `;
															var args0 = `;
															if (m0 == "String" && args0 != null && args0.length == 1) {
																@:ast(switch (args0[0].def) {
	case EVar(v0) if (v0 == "search_query"):
		true;	
	default:
		false;	
}) {
																	var ` = args0[0].def;
																	if (enumIndex ` == 38) {
																		var ` = `[0];
																		{
																			var v0 = `;
																			if (v0 == "search_query") {
																				true;
																			} else {
																				false;
																			};
																		};
																	} else {
																		false;
																	};
																};
															} else {
																false;
															};
														};
													} else {
														false;
													};
												} else {
													false;
												};
											};
										} else {
											false;
										};
									};
									if (isDown) {
										@:ast(switch (left0.def) {
	case EVar(nm) if (nm != "query"):
		forceQuery = true;	
	case EUnderscore:
		forceQuery = true;	
	default:
}) {
											var ` = left0.def;
											switch (enumIndex `) {
												case 38: {
													var ` = `[0];
													{
														var nm = `;
														if (nm != "query") {
															forceQuery = true;
														} else {};
													};
												};
												case 40: {
													{
														forceQuery = true;
													};
												};
												default: {}
											};
										};
									};
									if (forceQuery) {
										return {def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, {
											var pos = null;
											{def : reflaxe.elixir.ast.ElixirASTDef.EVar("query"), metadata : {}, pos : pos};
										}, rhs0), metadata : n.metadata, pos : n.pos};
									} else {
										n;
									};
								};
							};
						} else {
							n;
						};
					};
					case 53: {
						var ` = `[0];
						{
							var nb = reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.finalizeBranch(n);
							nb;
						};
					};
					case 55: {
						var ` = `[0];
						{
							var nb2 = reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.finalizeBranch(n);
							nb2;
						};
					};
					default: {
						n;
					}
				};
			};
		});
	}

	static function detectSearchGuard(cond:reflaxe.elixir.ast.ElixirAST) {
		var hasNotIsNil = [false];
		var hasNotEmpty = [false];
		var scan = [null];
		scan[0] = function(x:reflaxe.elixir.ast.ElixirAST) {
			if (x == null || x.def == null) {
				return;
			};
			@:ast(switch (x.def) {
	case EUnary(Not, inner):
		switch (inner.def) {
			case ERemoteCall({ def : EVar(m) }, fname, args) if ((m == "Kernel" || m == null) && fname == "is_nil" && args != null && args.length == 1):
				switch (args[0].def) {
					case EVar(vn) if (vn == "search_query"):
						hasNotIsNil = true;					
					default:
				};			
			case ECall(_, fname2, args2) if (fname2 == "is_nil" && args2 != null && args2.length == 1):
				switch (args2[0].def) {
					case EVar(vn2) if (vn2 == "search_query"):
						hasNotIsNil = true;					
					default:
				};			
			default:
		};	
	case EBinary(NotEqual, l, r):
		var leftIs = switch (l.def) {
			case EVar(nm) if (nm == "search_query"):
				true;			
			default:
				false;			
		};
		var rightIsEmpty = switch (r.def) {
			case EString(s) if (s == ""):
				true;			
			default:
				false;			
		};
		var rightIs = switch (r.def) {
			case EVar(nm2) if (nm2 == "search_query"):
				true;			
			default:
				false;			
		};
		var leftIsEmpty = switch (l.def) {
			case EString(s2) if (s2 == ""):
				true;			
			default:
				false;			
		};
		if ((leftIs && rightIsEmpty) || (rightIs && leftIsEmpty)) hasNotEmpty = true;	
	case EBinary(_, a, b):
		scan(a);
		scan(b);	
	default:
}) {
				var ` = x.def;
				switch (enumIndex `) {
					case 26: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						if (enumIndex ` == 7) {
							{
								var l = `;
								var r = `;
								{
									var leftIs = @:ast(switch (l.def) {
	case EVar(nm) if (nm == "search_query"):
		true;	
	default:
		false;	
}) {
										var ` = l.def;
										if (enumIndex ` == 38) {
											var ` = `[0];
											{
												var nm = `;
												if (nm == "search_query") {
													true;
												} else {
													false;
												};
											};
										} else {
											false;
										};
									};
									var rightIsEmpty = @:ast(switch (r.def) {
	case EString(s) if (s == ""):
		true;	
	default:
		false;	
}) {
										var ` = r.def;
										if (enumIndex ` == 32) {
											var ` = `[0];
											{
												var s = `;
												if (s == "") {
													true;
												} else {
													false;
												};
											};
										} else {
											false;
										};
									};
									var rightIs = @:ast(switch (r.def) {
	case EVar(nm2) if (nm2 == "search_query"):
		true;	
	default:
		false;	
}) {
										var ` = r.def;
										if (enumIndex ` == 38) {
											var ` = `[0];
											{
												var nm2 = `;
												if (nm2 == "search_query") {
													true;
												} else {
													false;
												};
											};
										} else {
											false;
										};
									};
									var leftIsEmpty = @:ast(switch (l.def) {
	case EString(s2) if (s2 == ""):
		true;	
	default:
		false;	
}) {
										var ` = l.def;
										if (enumIndex ` == 32) {
											var ` = `[0];
											{
												var s2 = `;
												if (s2 == "") {
													true;
												} else {
													false;
												};
											};
										} else {
											false;
										};
									};
									if ((leftIs && rightIsEmpty) || (rightIs && leftIsEmpty)) {
										hasNotEmpty[0] = true;
									};
								};
							};
						} else {
							var a = `;
							var b = `;
							{
								scan[0](a);
								scan[0](b);
							};
						};
					};
					case 27: {
						var ` = `[0];
						var ` = `[1];
						if (enumIndex ` == 0) {
							{
								var inner = `;
								{
									@:ast(switch (inner.def) {
	case ERemoteCall({ def : EVar(m) }, fname, args) if ((m == "Kernel" || m == null) && fname == "is_nil" && args != null && args.length == 1):
		switch (args[0].def) {
			case EVar(vn) if (vn == "search_query"):
				hasNotIsNil = true;			
			default:
		};	
	case ECall(_, fname2, args2) if (fname2 == "is_nil" && args2 != null && args2.length == 1):
		switch (args2[0].def) {
			case EVar(vn2) if (vn2 == "search_query"):
				hasNotIsNil = true;			
			default:
		};	
	default:
}) {
										var ` = inner.def;
										switch (enumIndex `) {
											case 22: {
												var ` = `[0];
												var ` = `[1];
												var ` = `[2];
												{
													var fname2 = `;
													var args2 = `;
													if (fname2 == "is_nil" && args2 != null && args2.length == 1) {
														@:ast(switch (args2[0].def) {
	case EVar(vn2) if (vn2 == "search_query"):
		hasNotIsNil = true;	
	default:
}) {
															var ` = args2[0].def;
															if (enumIndex ` == 38) {
																var ` = `[0];
																{
																	var vn2 = `;
																	if (vn2 == "search_query") {
																		hasNotIsNil[0] = true;
																	} else {};
																};
															} else {};
														};
													} else {};
												};
											};
											case 24: {
												var ` = `[0];
												var ` = `[1];
												var ` = `[2];
												{
													var ` = `.def;
													var ` = `.metadata;
													var ` = `.pos;
													if (enumIndex ` == 38) {
														var ` = `[0];
														{
															var m = `;
															var fname = `;
															var args = `;
															if ((m == "Kernel" || m == null) && fname == "is_nil" && args != null && args.length == 1) {
																@:ast(switch (args[0].def) {
	case EVar(vn) if (vn == "search_query"):
		hasNotIsNil = true;	
	default:
}) {
																	var ` = args[0].def;
																	if (enumIndex ` == 38) {
																		var ` = `[0];
																		{
																			var vn = `;
																			if (vn == "search_query") {
																				hasNotIsNil[0] = true;
																			} else {};
																		};
																	} else {};
																};
															} else {};
														};
													} else {};
												};
											};
											default: {}
										};
									};
								};
							};
						} else {};
					};
					default: {}
				};
			};
		};
		scan[0](cond);
		return hasNotIsNil[0] && hasNotEmpty[0];
	}

	static function isWildcardDowncase(s:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (s.def) {
	case EMatch(PWildcard, rhs):
		switch (rhs.def) {
			case ERemoteCall({ def : EVar(m) }, "downcase", args) if (m == "String" && args != null && args.length == 1):
				switch (args[0].def) {
					case EVar(v) if (v == "search_query"):
						true;					
					default:
						false;					
				};			
			default:
				false;			
		};	
	case EBinary(Match, left, rhs2):
		var isWild = switch (left.def) {
			case EVar(nm) if (nm == "_"):
				true;			
			default:
				false;			
		};
		if (!isWild) return false;
		switch (rhs2.def) {
			case ERemoteCall({ def : EVar(m2) }, "downcase", args2) if (m2 == "String" && args2 != null && args2.length == 1):
				switch (args2[0].def) {
					case EVar(v2) if (v2 == "search_query"):
						true;					
					default:
						false;					
				};			
			default:
				false;			
		};	
	default:
		false;	
}) {
			var ` = s.def;
			switch (enumIndex `) {
				case 8: {
					var ` = `[0];
					var ` = `[1];
					if (enumIndex ` == 8) {
						{
							var rhs = `;
							{
								@:ast(switch (rhs.def) {
	case ERemoteCall({ def : EVar(m) }, "downcase", args) if (m == "String" && args != null && args.length == 1):
		switch (args[0].def) {
			case EVar(v) if (v == "search_query"):
				true;			
			default:
				false;			
		};	
	default:
		false;	
}) {
									var ` = rhs.def;
									if (enumIndex ` == 24) {
										var ` = `[0];
										var ` = `[1];
										var ` = `[2];
										{
											var ` = `.def;
											var ` = `.metadata;
											var ` = `.pos;
											if (enumIndex ` == 38) {
												var ` = `[0];
												if (` == "downcase") {
													{
														var m = `;
														var args = `;
														if (m == "String" && args != null && args.length == 1) {
															@:ast(switch (args[0].def) {
	case EVar(v) if (v == "search_query"):
		true;	
	default:
		false;	
}) {
																var ` = args[0].def;
																if (enumIndex ` == 38) {
																	var ` = `[0];
																	{
																		var v = `;
																		if (v == "search_query") {
																			true;
																		} else {
																			false;
																		};
																	};
																} else {
																	false;
																};
															};
														} else {
															false;
														};
													};
												} else {
													false;
												};
											} else {
												false;
											};
										};
									} else {
										false;
									};
								};
							};
						};
					} else {
						false;
					};
				};
				case 26: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					if (enumIndex ` == 27) {
						{
							var left = `;
							var rhs2 = `;
							{
								var isWild = @:ast(switch (left.def) {
	case EVar(nm) if (nm == "_"):
		true;	
	default:
		false;	
}) {
									var ` = left.def;
									if (enumIndex ` == 38) {
										var ` = `[0];
										{
											var nm = `;
											if (nm == "_") {
												true;
											} else {
												false;
											};
										};
									} else {
										false;
									};
								};
								if (! isWild) {
									return false;
								};
								@:ast(switch (rhs2.def) {
	case ERemoteCall({ def : EVar(m2) }, "downcase", args2) if (m2 == "String" && args2 != null && args2.length == 1):
		switch (args2[0].def) {
			case EVar(v2) if (v2 == "search_query"):
				true;			
			default:
				false;			
		};	
	default:
		false;	
}) {
									var ` = rhs2.def;
									if (enumIndex ` == 24) {
										var ` = `[0];
										var ` = `[1];
										var ` = `[2];
										{
											var ` = `.def;
											var ` = `.metadata;
											var ` = `.pos;
											if (enumIndex ` == 38) {
												var ` = `[0];
												if (` == "downcase") {
													{
														var m2 = `;
														var args2 = `;
														if (m2 == "String" && args2 != null && args2.length == 1) {
															@:ast(switch (args2[0].def) {
	case EVar(v2) if (v2 == "search_query"):
		true;	
	default:
		false;	
}) {
																var ` = args2[0].def;
																if (enumIndex ` == 38) {
																	var ` = `[0];
																	{
																		var v2 = `;
																		if (v2 == "search_query") {
																			true;
																		} else {
																			false;
																		};
																	};
																} else {
																	false;
																};
															};
														} else {
															false;
														};
													};
												} else {
													false;
												};
											} else {
												false;
											};
										};
									} else {
										false;
									};
								};
							};
						};
					} else {
						false;
					};
				};
				default: {
					false;
				}
			};
		};
	}

	static function isAnyDowncaseBinder(s:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (s.def) {
	case EBinary(Match, left, rhs):
		var lname:Null<String> = switch (left.def) {
			case EVar(nm):
				nm;			
			default:
				null;			
		};
		if (lname == null) return { match : false, renameNeeded : false };
		switch (rhs.def) {
			case ERemoteCall({ def : EVar(m) }, "downcase", args) if (m == "String" && args != null && args.length == 1):
				switch (args[0].def) {
					case EVar(v) if (v == "search_query"):
						{ match : true, renameNeeded : lname != "query" };					
					default:
						{ match : false, renameNeeded : false };					
				};			
			default:
				{ match : false, renameNeeded : false };			
		};	
	default:
		{ match : false, renameNeeded : false };	
}) {
			var ` = s.def;
			if (enumIndex ` == 26) {
				var ` = `[0];
				var ` = `[1];
				var ` = `[2];
				if (enumIndex ` == 27) {
					{
						var left = `;
						var rhs = `;
						{
							var lname = @:ast(switch (left.def) {
	case EVar(nm):
		nm;	
	default:
		null;	
}) {
								var ` = left.def;
								if (enumIndex ` == 38) {
									var ` = `[0];
									{
										var nm = `;
										{
											nm;
										};
									};
								} else {
									null;
								};
							};
							if (lname == null) {
								return {match : false, renameNeeded : false};
							};
							@:ast(switch (rhs.def) {
	case ERemoteCall({ def : EVar(m) }, "downcase", args) if (m == "String" && args != null && args.length == 1):
		switch (args[0].def) {
			case EVar(v) if (v == "search_query"):
				{ match : true, renameNeeded : lname != "query" };			
			default:
				{ match : false, renameNeeded : false };			
		};	
	default:
		{ match : false, renameNeeded : false };	
}) {
								var ` = rhs.def;
								if (enumIndex ` == 24) {
									var ` = `[0];
									var ` = `[1];
									var ` = `[2];
									{
										var ` = `.def;
										var ` = `.metadata;
										var ` = `.pos;
										if (enumIndex ` == 38) {
											var ` = `[0];
											if (` == "downcase") {
												{
													var m = `;
													var args = `;
													if (m == "String" && args != null && args.length == 1) {
														@:ast(switch (args[0].def) {
	case EVar(v) if (v == "search_query"):
		{ match : true, renameNeeded : lname != "query" };	
	default:
		{ match : false, renameNeeded : false };	
}) {
															var ` = args[0].def;
															if (enumIndex ` == 38) {
																var ` = `[0];
																{
																	var v = `;
																	if (v == "search_query") {
																		{match : true, renameNeeded : lname != "query"};
																	} else {
																		{match : false, renameNeeded : false};
																	};
																};
															} else {
																{match : false, renameNeeded : false};
															};
														};
													} else {
														{match : false, renameNeeded : false};
													};
												};
											} else {
												{match : false, renameNeeded : false};
											};
										} else {
											{match : false, renameNeeded : false};
										};
									};
								} else {
									{match : false, renameNeeded : false};
								};
							};
						};
					};
				} else {
					{match : false, renameNeeded : false};
				};
			} else {
				{match : false, renameNeeded : false};
			};
		};
	}

	static function isQueryDowncaseBinder(s:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (s.def) {
	case EBinary(Match, left, rhs):
		var isQ = switch (left.def) {
			case EVar(nm) if (nm == "query"):
				true;			
			default:
				false;			
		};
		if (!isQ) false else switch (rhs.def) {
			case ERemoteCall({ def : EVar(m) }, "downcase", args) if (m == "String" && args != null && args.length == 1):
				true;			
			default:
				false;			
		};	
	case EMatch(pat, rhs2):
		var isQ2 = switch (pat) {
			case PVar(nm2) if (nm2 == "query"):
				true;			
			default:
				false;			
		};
		if (!isQ2) false else switch (rhs2.def) {
			case ERemoteCall({ def : EVar(m2) }, "downcase", args2) if (m2 == "String" && args2 != null && args2.length == 1):
				true;			
			default:
				false;			
		};	
	default:
		false;	
}) {
			var ` = s.def;
			switch (enumIndex `) {
				case 8: {
					var ` = `[0];
					var ` = `[1];
					{
						var pat = `;
						var rhs2 = `;
						{
							var isQ2 = @:ast(switch (pat) {
	case PVar(nm2) if (nm2 == "query"):
		true;	
	default:
		false;	
}) if (enumIndex pat == 0) {
								var ` = pat[0];
								{
									var nm2 = `;
									if (nm2 == "query") {
										true;
									} else {
										false;
									};
								};
							} else {
								false;
							};
							if (! isQ2) {
								false;
							} else {
								@:ast(switch (rhs2.def) {
	case ERemoteCall({ def : EVar(m2) }, "downcase", args2) if (m2 == "String" && args2 != null && args2.length == 1):
		true;	
	default:
		false;	
}) {
									var ` = rhs2.def;
									if (enumIndex ` == 24) {
										var ` = `[0];
										var ` = `[1];
										var ` = `[2];
										{
											var ` = `.def;
											var ` = `.metadata;
											var ` = `.pos;
											if (enumIndex ` == 38) {
												var ` = `[0];
												if (` == "downcase") {
													{
														var m2 = `;
														var args2 = `;
														if (m2 == "String" && args2 != null && args2.length == 1) {
															true;
														} else {
															false;
														};
													};
												} else {
													false;
												};
											} else {
												false;
											};
										};
									} else {
										false;
									};
								};
							};
						};
					};
				};
				case 26: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					if (enumIndex ` == 27) {
						{
							var left = `;
							var rhs = `;
							{
								var isQ = @:ast(switch (left.def) {
	case EVar(nm) if (nm == "query"):
		true;	
	default:
		false;	
}) {
									var ` = left.def;
									if (enumIndex ` == 38) {
										var ` = `[0];
										{
											var nm = `;
											if (nm == "query") {
												true;
											} else {
												false;
											};
										};
									} else {
										false;
									};
								};
								if (! isQ) {
									false;
								} else {
									@:ast(switch (rhs.def) {
	case ERemoteCall({ def : EVar(m) }, "downcase", args) if (m == "String" && args != null && args.length == 1):
		true;	
	default:
		false;	
}) {
										var ` = rhs.def;
										if (enumIndex ` == 24) {
											var ` = `[0];
											var ` = `[1];
											var ` = `[2];
											{
												var ` = `.def;
												var ` = `.metadata;
												var ` = `.pos;
												if (enumIndex ` == 38) {
													var ` = `[0];
													if (` == "downcase") {
														{
															var m = `;
															var args = `;
															if (m == "String" && args != null && args.length == 1) {
																true;
															} else {
																false;
															};
														};
													} else {
														false;
													};
												} else {
													false;
												};
											};
										} else {
											false;
										};
									};
								};
							};
						};
					} else {
						false;
					};
				};
				default: {
					false;
				}
			};
		};
	}

	static function branchHasFilterLater(stmts:Array<reflaxe.elixir.ast.ElixirAST>, startIdx:Int) {
		var found = [false];
		var scan = [null];
		scan[0] = function(x:reflaxe.elixir.ast.ElixirAST) {
			if (x == null || x.def == null || found[0]) {
				return;
			};
			@:ast(switch (x.def) {
	case ERemoteCall({ def : EVar(m) }, "filter", _) if (m == "Enum"):
		found = true;	
	case ECall(_, "filter", _):
		found = true;	
	case EBlock(ss):
		for (s  in  ss) scan(s);	
	case EDo(ss2):
		for (s  in  ss2) scan(s);	
	case EIf(c, t, e):
		scan(c);
		scan(t);
		if (e != null) scan(e);	
	case EMatch(_, rhs):
		scan(rhs);	
	case EBinary(_, l, r):
		scan(l);
		scan(r);	
	case ECall(tgt, _, args3):
		if (tgt != null) scan(tgt);
		for (a  in  args3) scan(a);	
	case ERemoteCall(tgt2, _, args4):
		scan(tgt2);
		for (a  in  args4) scan(a);	
	case ECase(expr, cs):
		scan(expr);
		for (c  in  cs) scan(c.body);	
	default:
}) {
				var ` = x.def;
				switch (enumIndex `) {
					case 6: {
						var ` = `[0];
						var ` = `[1];
						{
							var expr = `;
							var cs = `;
							{
								scan[0](expr);
								{
									var ` = 0;
									while (` < cs.length) {
										var c = cs[`];
										++ `;
										scan[0](c.body);
									};
								};
							};
						};
					};
					case 8: {
						var ` = `[0];
						var ` = `[1];
						{
							var rhs = `;
							{
								scan[0](rhs);
							};
						};
					};
					case 10: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var c = `;
							var t = `;
							var e = `;
							{
								scan[0](c);
								scan[0](t);
								if (e != null) {
									scan[0](e);
								};
							};
						};
					};
					case 22: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						if (` == "filter") {
							{
								found[0] = true;
							};
						} else {
							var tgt = `;
							var args3 = `;
							{
								if (tgt != null) {
									scan[0](tgt);
								};
								{
									var ` = 0;
									while (` < args3.length) {
										var a = args3[`];
										++ `;
										scan[0](a);
									};
								};
							};
						};
					};
					case 24: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var ` = `.def;
							var ` = `.metadata;
							var ` = `.pos;
							if (enumIndex ` == 38) {
								var ` = `[0];
								if (` == "filter") {
									{
										var m = `;
										if (m == "Enum") {
											found[0] = true;
										} else {
											var tgt2 = `;
											var args4 = `;
											{
												scan[0](tgt2);
												{
													var ` = 0;
													while (` < args4.length) {
														var a = args4[`];
														++ `;
														scan[0](a);
													};
												};
											};
										};
									};
								} else {
									var tgt2 = `;
									var args4 = `;
									{
										scan[0](tgt2);
										{
											var ` = 0;
											while (` < args4.length) {
												var a = args4[`];
												++ `;
												scan[0](a);
											};
										};
									};
								};
							} else {
								var tgt2 = `;
								var args4 = `;
								{
									scan[0](tgt2);
									{
										var ` = 0;
										while (` < args4.length) {
											var a = args4[`];
											++ `;
											scan[0](a);
										};
									};
								};
							};
						};
					};
					case 26: {
						var ` = `[0];
						var ` = `[1];
						var ` = `[2];
						{
							var l = `;
							var r = `;
							{
								scan[0](l);
								scan[0](r);
							};
						};
					};
					case 53: {
						var ` = `[0];
						{
							var ss = `;
							{
								{
									var ` = 0;
									while (` < ss.length) {
										var s = ss[`];
										++ `;
										scan[0](s);
									};
								};
							};
						};
					};
					case 55: {
						var ` = `[0];
						{
							var ss2 = `;
							{
								{
									var ` = 0;
									while (` < ss2.length) {
										var s = ss2[`];
										++ `;
										scan[0](s);
									};
								};
							};
						};
					};
					default: {}
				};
			};
		};
		{
			var ` = startIdx;
			var ` = stmts.length;
			while (` < `) {
				var i = ` ++;
				scan[0](stmts[i]);
			};
		};
		return found[0];
	}

	static function isFilterStmt(s:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (s.def) {
	case ERemoteCall({ def : EVar(m) }, "filter", _) if (m == "Enum"):
		true;	
	case ECall(_, "filter", _):
		true;	
	case EMatch(_, rhs):
		isFilterExpr(rhs);	
	case EBinary(Match, _, rhs2):
		isFilterExpr(rhs2);	
	default:
		false;	
}) {
			var ` = s.def;
			switch (enumIndex `) {
				case 8: {
					var ` = `[0];
					var ` = `[1];
					{
						var rhs = `;
						{
							reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isFilterExpr(rhs);
						};
					};
				};
				case 22: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					if (` == "filter") {
						{
							true;
						};
					} else {
						false;
					};
				};
				case 24: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					{
						var ` = `.def;
						var ` = `.metadata;
						var ` = `.pos;
						if (enumIndex ` == 38) {
							var ` = `[0];
							if (` == "filter") {
								{
									var m = `;
									if (m == "Enum") {
										true;
									} else {
										false;
									};
								};
							} else {
								false;
							};
						} else {
							false;
						};
					};
				};
				case 26: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					if (enumIndex ` == 27) {
						{
							var rhs2 = `;
							{
								reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isFilterExpr(rhs2);
							};
						};
					} else {
						false;
					};
				};
				default: {
					false;
				}
			};
		};
	}

	static function isFilterExpr(e:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (e.def) {
	case ERemoteCall({ def : EVar(m) }, "filter", _) if (m == "Enum"):
		true;	
	case ECall(_, "filter", _):
		true;	
	default:
		false;	
}) {
			var ` = e.def;
			switch (enumIndex `) {
				case 22: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					if (` == "filter") {
						{
							true;
						};
					} else {
						false;
					};
				};
				case 24: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					{
						var ` = `.def;
						var ` = `.metadata;
						var ` = `.pos;
						if (enumIndex ` == 38) {
							var ` = `[0];
							if (` == "filter") {
								{
									var m = `;
									if (m == "Enum") {
										true;
									} else {
										false;
									};
								};
							} else {
								false;
							};
						} else {
							false;
						};
					};
				};
				default: {
					false;
				}
			};
		};
	}

	static inline function isIdentChar(c:String) {
		if (c == null || c.length == 0) {
			return false;
		};
		var ch = c.charCodeAt(0);
		return (ch >= 48 && ch <= 57) || (ch >= 65 && ch <= 90) || (ch >= 97 && ch <= 122) || c == "_";
	}

	static function rawContainsIdent(code:String, ident:String) {
		if (code == null || ident == null || ident.length == 0) {
			return false;
		};
		var start = 0;
		var len = ident.length;
		while (true) {
			var i = code.indexOf(ident, start);
			if (i == -1) {
				break;
			};
			var before = if (i > 0) {
				code.substr(i - 1, 1);
			} else {
				null;
			};
			var afterIdx = i + len;
			var after = if (afterIdx < code.length) {
				code.substr(afterIdx, 1);
			} else {
				null;
			};
			if (! if (before == null || before.length == 0) {
				false;
			} else {
				var ch = before.charCodeAt(0);
				(ch >= 48 && ch <= 57) || (ch >= 65 && ch <= 90) || (ch >= 97 && ch <= 122) || before == "_";
			} && ! if (after == null || after.length == 0) {
				false;
			} else {
				var ch = after.charCodeAt(0);
				(ch >= 48 && ch <= 57) || (ch >= 65 && ch <= 90) || (ch >= 97 && ch <= 122) || after == "_";
			}) {
				return true;
			};
			start = i + len;
		};
		return false;
	}

	static function predicateUsesQueryInStmt(s:reflaxe.elixir.ast.ElixirAST) {
		var found = [false];
		var usesIn = function(e:reflaxe.elixir.ast.ElixirAST) {
			if (e == null || e.def == null || found[0]) {
				return;
			};
			@:ast(switch (e.def) {
	case EFn(clauses):
		for (cl  in  clauses) if (cl.body != null) ElixirASTTransformer.transformNode(cl.body, function(x) {
			if (found) return x;
			switch (x.def) {
				case EVar(nm) if (nm == "query"):
					found = true;
					return x;				
				case ERaw(code) if (code != null && rawContainsIdent(code, "query")):
					found = true;
					return x;				
				default:
					return x;				
			};
		});	
	case ERaw(code) if (code != null && code.indexOf("Enum.filter(") != -1 && rawContainsIdent(code, "query")):
		found = true;	
	default:
}) {
				var ` = e.def;
				switch (enumIndex `) {
					case 42: {
						var ` = `[0];
						{
							var clauses = `;
							{
								{
									var ` = 0;
									while (` < clauses.length) {
										var cl = clauses[`];
										++ `;
										if (cl.body != null) {
											reflaxe.elixir.ast.ElixirASTTransformer.transformNode(cl.body, function(x:reflaxe.elixir.ast.ElixirAST) {
												if (found[0]) {
													return x;
												};
												@:ast(switch (x.def) {
	case EVar(nm) if (nm == "query"):
		found = true;
		return x;	
	case ERaw(code) if (code != null && rawContainsIdent(code, "query")):
		found = true;
		return x;	
	default:
		return x;	
}) {
													var ` = x.def;
													switch (enumIndex `) {
														case 38: {
															var ` = `[0];
															{
																var nm = `;
																if (nm == "query") {
																	found[0] = true;
																	return x;
																} else {
																	return x;
																};
															};
														};
														case 62: {
															var ` = `[0];
															{
																var code = `;
																if (code != null && reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.rawContainsIdent(code, "query")) {
																	found[0] = true;
																	return x;
																} else {
																	return x;
																};
															};
														};
														default: {
															return x;
														}
													};
												};
											});
										};
									};
								};
							};
						};
					};
					case 62: {
						var ` = `[0];
						{
							var code = `;
							if (code != null && code.indexOf("Enum.filter(", null) != -1 && reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.rawContainsIdent(code, "query")) {
								found[0] = true;
							} else {};
						};
					};
					default: {}
				};
			};
		};
		@:ast(switch (s.def) {
	case ERemoteCall({ def : EVar(m) }, "filter", args) if (m == "Enum" && args.length == 2):
		usesIn(args[1]);	
	case ECall(_, "filter", args2) if (args2.length >= 1):
		var pred = args2[args2.length - 1];
		usesIn(pred);	
	case EMatch(_, rhs):
		if (isFilterExpr(rhs)) usesIn(rhs);	
	case EBinary(Match, _, rhs2):
		if (isFilterExpr(rhs2)) usesIn(rhs2);	
	default:
}) {
			var ` = s.def;
			switch (enumIndex `) {
				case 8: {
					var ` = `[0];
					var ` = `[1];
					{
						var rhs = `;
						{
							if (reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isFilterExpr(rhs)) {
								usesIn(rhs);
							};
						};
					};
				};
				case 22: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					if (` == "filter") {
						{
							var args2 = `;
							if (args2.length >= 1) {
								var pred = args2[args2.length - 1];
								usesIn(pred);
							} else {};
						};
					} else {};
				};
				case 24: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					{
						var ` = `.def;
						var ` = `.metadata;
						var ` = `.pos;
						if (enumIndex ` == 38) {
							var ` = `[0];
							if (` == "filter") {
								{
									var m = `;
									var args = `;
									if (m == "Enum" && args.length == 2) {
										usesIn(args[1]);
									} else {};
								};
							} else {};
						} else {};
					};
				};
				case 26: {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					if (enumIndex ` == 27) {
						{
							var rhs2 = `;
							{
								if (reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isFilterExpr(rhs2)) {
									usesIn(rhs2);
								};
							};
						};
					} else {};
				};
				default: {}
			};
		};
		return found[0];
	}

	static function hasDefinedQueryBefore(stmts:Array<reflaxe.elixir.ast.ElixirAST>, idx:Int) {
		{
			var ` = 0;
			var ` = idx;
			while (` < `) {
				var k = ` ++;
				@:ast(switch (stmts[k].def) {
	case EBinary(Match, left, _):
		switch (left.def) {
			case EVar(nm) if (nm == "query"):
				return true;			
			default:
		};	
	case EMatch(pat, _):
		switch (pat) {
			case PVar(nm2) if (nm2 == "query"):
				return true;			
			default:
		};	
	default:
}) {
					var ` = stmts[k].def;
					switch (enumIndex `) {
						case 8: {
							var ` = `[0];
							var ` = `[1];
							{
								var pat = `;
								{
									@:ast(switch (pat) {
	case PVar(nm2) if (nm2 == "query"):
		return true;	
	default:
}) if (enumIndex pat == 0) {
										var ` = pat[0];
										{
											var nm2 = `;
											if (nm2 == "query") {
												return true;
											} else {};
										};
									} else {};
								};
							};
						};
						case 26: {
							var ` = `[0];
							var ` = `[1];
							var ` = `[2];
							if (enumIndex ` == 27) {
								{
									var left = `;
									{
										@:ast(switch (left.def) {
	case EVar(nm) if (nm == "query"):
		return true;	
	default:
}) {
											var ` = left.def;
											if (enumIndex ` == 38) {
												var ` = `[0];
												{
													var nm = `;
													if (nm == "query") {
														return true;
													} else {};
												};
											} else {};
										};
									};
								};
							} else {};
						};
						default: {}
					};
				};
			};
		};
		return false;
	}

	static function finalizeBranch(thenB:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (thenB.def) {
	case EDo(es):
		var out = [];
		var promoted = false;
		var seenQuery = false;
		for (i  in  0 ... es.length) {
			var s = es[i];
			if (isQueryDowncaseBinder(s)) {
				out.push(s);
				seenQuery = true;
				continue;
			};
			var nextIsFilter = (i + 1 < es.length) && isFilterStmt(es[i + 1]);
			if (!promoted && isWildcardDowncase(s) && (nextIsFilter || branchHasFilterLater(es, i + 1))) {
				switch (s.def) {
					case EMatch(_, rhs):
						out.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs), thenB.metadata, thenB.pos));
						promoted = true;					
					case EBinary(Match, _, rhsB):
						out.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhsB), thenB.metadata, thenB.pos));
						promoted = true;					
					default:
						out.push(s);					
				};
			} else if (seenQuery && isWildcardDowncase(s)) { } else out.push(s);
		};
		makeASTWithMeta(EDo(out), thenB.metadata, thenB.pos);	
	case EBlock(es2):
		var out2 = [];
		var promoted2 = false;
		var seenQuery2 = false;
		for (i  in  0 ... es2.length) {
			var s2 = es2[i];
			if (isQueryDowncaseBinder(s2)) {
				out2.push(s2);
				seenQuery2 = true;
				continue;
			};
			var anyDown = isAnyDowncaseBinder(s2);
			var nextIsFilter2 = (i + 1 < es2.length) && isFilterStmt(es2[i + 1]);
			if (!promoted2 && (isWildcardDowncase(s2) || (anyDown.match && anyDown.renameNeeded)) && (nextIsFilter2 || branchHasFilterLater(es2, i + 1))) {
				switch (s2.def) {
					case EMatch(_, rhs2):
						out2.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs2), thenB.metadata, thenB.pos));
						promoted2 = true;					
					case EBinary(Match, _, rhs2B):
						out2.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs2B), thenB.metadata, thenB.pos));
						promoted2 = true;					
					default:
						out2.push(s2);					
				};
			} else if (seenQuery2 && isWildcardDowncase(s2)) { } else {
				if (isFilterStmt(s2) && predicateUsesQueryInStmt(s2) && !hasDefinedQueryBefore(out2.concat(es2.slice(i)), 0)) {
					var rhsQ = makeAST(ERemoteCall(makeAST(EVar("String")), "downcase", [makeAST(EVar("search_query"))]));
					out2.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhsQ), thenB.metadata, thenB.pos));
				};
				out2.push(s2);
			};
		};
		makeASTWithMeta(EBlock(out2), thenB.metadata, thenB.pos);	
	default:
		thenB;	
}) {
			var ` = thenB.def;
			switch (enumIndex `) {
				case 53: {
					var ` = `[0];
					{
						var es2 = `;
						{
							var out2 = [];
							var promoted2 = false;
							var seenQuery2 = false;
							{
								var ` = 0;
								var ` = es2.length;
								while (` < `) {
									var i = ` ++;
									var s2 = es2[i];
									if (reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isQueryDowncaseBinder(s2)) {
										out2.push(s2);
										seenQuery2 = true;
										continue;
									};
									var anyDown = reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isAnyDowncaseBinder(s2);
									var nextIsFilter2 = (i + 1 < es2.length) && reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isFilterStmt(es2[i + 1]);
									if (! promoted2 && (reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isWildcardDowncase(s2) || (anyDown.match && anyDown.renameNeeded)) && (nextIsFilter2 || reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.branchHasFilterLater(es2, i + 1))) {
										@:ast(switch (s2.def) {
	case EMatch(_, rhs2):
		out2.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs2), thenB.metadata, thenB.pos));
		promoted2 = true;	
	case EBinary(Match, _, rhs2B):
		out2.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs2B), thenB.metadata, thenB.pos));
		promoted2 = true;	
	default:
		out2.push(s2);	
}) {
											var ` = s2.def;
											switch (enumIndex `) {
												case 8: {
													var ` = `[0];
													var ` = `[1];
													{
														var rhs2 = `;
														{
															out2.push({def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, {
																var pos = null;
																{def : reflaxe.elixir.ast.ElixirASTDef.EVar("query"), metadata : {}, pos : pos};
															}, rhs2), metadata : thenB.metadata, pos : thenB.pos});
															promoted2 = true;
														};
													};
												};
												case 26: {
													var ` = `[0];
													var ` = `[1];
													var ` = `[2];
													if (enumIndex ` == 27) {
														{
															var rhs2B = `;
															{
																out2.push({def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, {
																	var pos = null;
																	{def : reflaxe.elixir.ast.ElixirASTDef.EVar("query"), metadata : {}, pos : pos};
																}, rhs2B), metadata : thenB.metadata, pos : thenB.pos});
																promoted2 = true;
															};
														};
													} else {
														out2.push(s2);
													};
												};
												default: {
													out2.push(s2);
												}
											};
										};
									} else {
										if (seenQuery2 && reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isWildcardDowncase(s2)) {} else {
											if (reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isFilterStmt(s2) && reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.predicateUsesQueryInStmt(s2) && ! reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.hasDefinedQueryBefore(out2.concat(es2.slice(i, null)), 0)) {
												var rhsQ = {
													var pos = null;
													{def : reflaxe.elixir.ast.ElixirASTDef.ERemoteCall({
														var pos = null;
														{def : reflaxe.elixir.ast.ElixirASTDef.EVar("String"), metadata : {}, pos : pos};
													}, "downcase", [{
														var pos = null;
														{def : reflaxe.elixir.ast.ElixirASTDef.EVar("search_query"), metadata : {}, pos : pos};
													}]), metadata : {}, pos : pos};
												};
												out2.push({def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, {
													var pos = null;
													{def : reflaxe.elixir.ast.ElixirASTDef.EVar("query"), metadata : {}, pos : pos};
												}, rhsQ), metadata : thenB.metadata, pos : thenB.pos});
											};
											out2.push(s2);
										};
									};
								};
							};
							{def : reflaxe.elixir.ast.ElixirASTDef.EBlock(out2), metadata : thenB.metadata, pos : thenB.pos};
						};
					};
				};
				case 55: {
					var ` = `[0];
					{
						var es = `;
						{
							var out = [];
							var promoted = false;
							var seenQuery = false;
							{
								var ` = 0;
								var ` = es.length;
								while (` < `) {
									var i = ` ++;
									var s = es[i];
									if (reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isQueryDowncaseBinder(s)) {
										out.push(s);
										seenQuery = true;
										continue;
									};
									var nextIsFilter = (i + 1 < es.length) && reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isFilterStmt(es[i + 1]);
									if (! promoted && reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isWildcardDowncase(s) && (nextIsFilter || reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.branchHasFilterLater(es, i + 1))) {
										@:ast(switch (s.def) {
	case EMatch(_, rhs):
		out.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhs), thenB.metadata, thenB.pos));
		promoted = true;	
	case EBinary(Match, _, rhsB):
		out.push(makeASTWithMeta(EBinary(Match, makeAST(EVar("query")), rhsB), thenB.metadata, thenB.pos));
		promoted = true;	
	default:
		out.push(s);	
}) {
											var ` = s.def;
											switch (enumIndex `) {
												case 8: {
													var ` = `[0];
													var ` = `[1];
													{
														var rhs = `;
														{
															out.push({def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, {
																var pos = null;
																{def : reflaxe.elixir.ast.ElixirASTDef.EVar("query"), metadata : {}, pos : pos};
															}, rhs), metadata : thenB.metadata, pos : thenB.pos});
															promoted = true;
														};
													};
												};
												case 26: {
													var ` = `[0];
													var ` = `[1];
													var ` = `[2];
													if (enumIndex ` == 27) {
														{
															var rhsB = `;
															{
																out.push({def : reflaxe.elixir.ast.ElixirASTDef.EBinary(reflaxe.elixir.ast.EBinaryOp.Match, {
																	var pos = null;
																	{def : reflaxe.elixir.ast.ElixirASTDef.EVar("query"), metadata : {}, pos : pos};
																}, rhsB), metadata : thenB.metadata, pos : thenB.pos});
																promoted = true;
															};
														};
													} else {
														out.push(s);
													};
												};
												default: {
													out.push(s);
												}
											};
										};
									} else {
										if (seenQuery && reflaxe.elixir.ast.transformers.QueryBinderFinalizationTransforms.isWildcardDowncase(s)) {} else {
											out.push(s);
										};
									};
								};
							};
							{def : reflaxe.elixir.ast.ElixirASTDef.EDo(out), metadata : thenB.metadata, pos : thenB.pos};
						};
					};
				};
				default: {
					thenB;
				}
			};
		};
	}
}