class reflaxe.elixir.ast.transformers.IfConstSimplifyTransforms {

	public static function transformPass(ast:reflaxe.elixir.ast.ElixirAST) {
		return reflaxe.elixir.ast.ElixirASTTransformer.transformNode(ast, function(n:reflaxe.elixir.ast.ElixirAST) {
			return @:ast(switch (n.def) {
	case EIf(cond, thenBr, elseBr):
		if (isTruth(cond)) thenBr else if (isFalsey(cond)) (elseBr != null ? elseBr : makeASTWithMeta(ENil, n.metadata, n.pos)) else n;	
	default:
		n;	
}) {
				var ` = n.def;
				if (enumIndex ` == 10) {
					var ` = `[0];
					var ` = `[1];
					var ` = `[2];
					{
						var cond = `;
						var thenBr = `;
						var elseBr = `;
						{
							if (@:ast(switch (e.def) {
	case EBoolean(true):
		true;	
	case EAtom(a) if (a == "true"):
		true;	
	case EInteger(v) if (v == 1):
		true;	
	default:
		false;	
}) {
								var ` = cond.def;
								switch (enumIndex `) {
									case 31: {
										var ` = `[0];
										{
											var a = `;
											if (a == "true") {
												true;
											} else {
												false;
											};
										};
									};
									case 33: {
										var ` = `[0];
										{
											var v = `;
											if (v == 1) {
												true;
											} else {
												false;
											};
										};
									};
									case 35: {
										var ` = `[0];
										if (` == true) {
											{
												true;
											};
										} else {
											false;
										};
									};
									default: {
										false;
									}
								};
							}) {
								thenBr;
							} else {
								if (@:ast(switch (e.def) {
	case EBoolean(false):
		true;	
	case EAtom(a) if (a == "false"):
		true;	
	case EInteger(v) if (v == 0):
		true;	
	default:
		false;	
}) {
									var ` = cond.def;
									switch (enumIndex `) {
										case 31: {
											var ` = `[0];
											{
												var a = `;
												if (a == "false") {
													true;
												} else {
													false;
												};
											};
										};
										case 33: {
											var ` = `[0];
											{
												var v = `;
												if (v == 0) {
													true;
												} else {
													false;
												};
											};
										};
										case 35: {
											var ` = `[0];
											if (` == false) {
												{
													true;
												};
											} else {
												false;
											};
										};
										default: {
											false;
										}
									};
								}) {
									(if (elseBr != null) {
										elseBr;
									} else {
										{def : reflaxe.elixir.ast.ElixirASTDef.ENil, metadata : n.metadata, pos : n.pos};
									});
								} else {
									n;
								};
							};
						};
					};
				} else {
					n;
				};
			};
		});
	}

	static inline function isTruth(e:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (e.def) {
	case EBoolean(true):
		true;	
	case EAtom(a) if (a == "true"):
		true;	
	case EInteger(v) if (v == 1):
		true;	
	default:
		false;	
}) {
			var ` = e.def;
			switch (enumIndex `) {
				case 31: {
					var ` = `[0];
					{
						var a = `;
						if (a == "true") {
							true;
						} else {
							false;
						};
					};
				};
				case 33: {
					var ` = `[0];
					{
						var v = `;
						if (v == 1) {
							true;
						} else {
							false;
						};
					};
				};
				case 35: {
					var ` = `[0];
					if (` == true) {
						{
							true;
						};
					} else {
						false;
					};
				};
				default: {
					false;
				}
			};
		};
	}

	static inline function isFalsey(e:reflaxe.elixir.ast.ElixirAST) {
		return @:ast(switch (e.def) {
	case EBoolean(false):
		true;	
	case EAtom(a) if (a == "false"):
		true;	
	case EInteger(v) if (v == 0):
		true;	
	default:
		false;	
}) {
			var ` = e.def;
			switch (enumIndex `) {
				case 31: {
					var ` = `[0];
					{
						var a = `;
						if (a == "false") {
							true;
						} else {
							false;
						};
					};
				};
				case 33: {
					var ` = `[0];
					{
						var v = `;
						if (v == 0) {
							true;
						} else {
							false;
						};
					};
				};
				case 35: {
					var ` = `[0];
					if (` == false) {
						{
							true;
						};
					} else {
						false;
					};
				};
				default: {
					false;
				}
			};
		};
	}
}